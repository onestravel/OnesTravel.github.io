<!DOCTYPE html>
<html  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <meta name="description" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  <link rel="icon" href="/favicon.png">
  <title>【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍</title>
  
  
  <meta property="og:title" content="【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍">
  
  
  <meta property="og:url" content="https://blog.onestravel.cn/20190325/0bf1498a9d8f/index.html">
  
  
  <meta property="og:img" content="/images/20190325/ffmpeg_start.jpg">
  
  
  <meta property="og:img" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2019-03-25">
  <meta property="og:article:modified_time" content="2022-10-08">
  <meta property="og:article:author" content="一个人的旅行">
  
  
  <meta property="og:article:tag" content="Android">
  
  <meta property="og:article:tag" content="NDK">
  
  <meta property="og:article:tag" content="FFmpeg">
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" as="script">
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" as="script">
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
<link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/favicon.png" alt="logo">
      
      <span class="navbar-logo-dsc">一个人的旅行</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于
    
    </a>
    
    <a href="/friends" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<div class="image-wrapper">
  <img src="/images/20190325/ffmpeg_start.jpg" data-src="/images/20190325/ffmpeg_start.jpg"
    srcset="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20300%20300&#39;%3E%3C/svg%3E"
    class="image lozad"
    alt="thumbnail"
  >
</div>

<article class="card card-content">
  <header>
    <h1 class="post-title">
      【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2019-03-25T02:15:00.000Z">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2019-03-25</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/NDK/" class="post-meta-link">NDK</a>
    
    
    
    <span class="dot"></span>
    <span>3.4k 字</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/Android/" class="post-meta-link">Android</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/NDK/" class="post-meta-link">NDK</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/FFmpeg/" class="post-meta-link">FFmpeg</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <h1 id="【FFmpeg】-一-音视频相关基础知识以及FFmpeg介绍"><a href="#【FFmpeg】-一-音视频相关基础知识以及FFmpeg介绍" class="headerlink" title="【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍"></a>【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍</h1><h2 id="一、音视频相关基础知识"><a href="#一、音视频相关基础知识" class="headerlink" title="一、音视频相关基础知识"></a>一、音视频相关基础知识</h2><h3 id="1、视频播放器原理"><a href="#1、视频播放器原理" class="headerlink" title="1、视频播放器原理"></a>1、视频播放器原理</h3><p><strong>视频播放器就是将一个封装的格式数据进行解封装，得到对应的音频压缩数据和视频压缩数据，再进行相应的音视频解码，得到音频采样数据和视频采样数据，最后将音频采样数据和视频采样数据同时播放，达到音视频同步。</strong></p>
<ul>
<li><strong>封装格式数据通常有FLV、MKV、MP4、AVI、RMVB 等等</strong></li>
<li><strong>录音、录像的实质就是一个压缩采集到的图像或者音频数据的过程，这个过程又称为编码</strong></li>
<li><strong>播放视频或者音频文件，实质上是一个解压缩的过程，这个过程又称为解码</strong></li>
</ul>
<p><img src="/images/20190325/shipinyuanli.png" alt="视频播放器原理" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190325/shipinyuanli.png" class="lozad post-image"></p>
<h4 id="1-1-解封装"><a href="#1-1-解封装" class="headerlink" title="1.1 解封装"></a>1.1 解封装</h4><p><strong>将封装格式的数据，分离成为音频流压缩编码数据和视频流压缩编码数据。封装格式种类很多，例如MP4，MKV，RMVB，TS，FLV，AVI等等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放到一起，输出特定编码格式的视频码流和A音频码流。</strong></p>
<h4 id="1-2-解码"><a href="#1-2-解码" class="headerlink" title="1.2 解码"></a>1.2 解码</h4><h5 id="1-2-1-音频压缩数据解码"><a href="#1-2-1-音频压缩数据解码" class="headerlink" title="1.2.1 音频压缩数据解码"></a>1.2.1 音频压缩数据解码</h5><p><strong>一般我们常见的音频压缩编码标准包含AAC，MP3，AC-3，WMA 等等；通过解码将压缩编码的音频数据输出成为非压缩的音频采样数据，例如PCM数据</strong></p>
<ul>
<li><strong>AAC</strong>：数据由大小不固定的ADTS构成</li>
<li><strong>PCM</strong>：单声道的情况下按照顺序存储每个采样点的数据；双声道的情况下按照 “左右、左右”的顺序存储每个采样点两个声道的数据</li>
</ul>
<p><strong>采样率</strong>：也称为采样速度或者采样率，定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（Hz）来表示。采样频率的倒数是采样周期或者叫作采样时间，它是采样之间的时间间隔。通俗的讲采样频率是指计算机每秒钟采集多少个信号样本。</p>
<h5 id="1-2-2-视频压缩数据解码"><a href="#1-2-2-视频压缩数据解码" class="headerlink" title="1.2.2 视频压缩数据解码"></a>1.2.2 视频压缩数据解码</h5><p><strong>一般我们常见的视频的压缩编码标准则包含H.264，MPEG2，VC-1等等；压缩编码的视频数据输出成为视频像素数据（非压缩的颜色数据），例如YUV(YUV420P,YUV422P,YUV444P;最常见为YUV420P)，RGB(RGB24,RGB32)等等。Y：亮度，U：色度，V：浓度</strong></p>
<ul>
<li><strong>H.264</strong>：数据由大学不固定的NALU构成，最常见情况下，1个NALU存储了1帧画面的压缩编码后的数据</li>
</ul>
<h4 id="1-3-音视频同步"><a href="#1-3-音视频同步" class="headerlink" title="1.3 音视频同步"></a>1.3 音视频同步</h4><p><strong>根据解封装模块过程中获取到的参数信息，同步解码得到的音频和视频数据，并将音频和视频数据送至系统的声卡和显卡播放出来。</strong></p>
<h2 id="二、FFmpeg-介绍"><a href="#二、FFmpeg-介绍" class="headerlink" title="二、FFmpeg 介绍"></a>二、FFmpeg 介绍</h2><h3 id="1、定义"><a href="#1、定义" class="headerlink" title="1、定义"></a>1、定义</h3><p><strong>FFmpeg是一套可以用来记录、转换数字音频、视频，并能将其转化为流的开源计算机程序。采用LGPL或GPL许可证。它提供了录制、转换以及流化音视频的完整解决方案。它包含了非常先进的音频/视频编解码库libavcodec，为了保证高可移植性和编解码质量，libavcodec里很多code都是从头开发的。</strong></p>
<h3 id="2、FFmpeg-命令"><a href="#2、FFmpeg-命令" class="headerlink" title="2、FFmpeg 命令"></a>2、FFmpeg 命令</h3><h4 id="2-1-视频格式转换命令"><a href="#2-1-视频格式转换命令" class="headerlink" title="2.1 视频格式转换命令"></a>2.1 视频格式转换命令</h4><table>
<thead>
<tr>
<th>命令参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>源文件</td>
</tr>
<tr>
<td>-o</td>
<td>输出文件</td>
</tr>
<tr>
<td>```</td>
<td></td>
</tr>
<tr>
<td>//进入到FFmpeg 的 bin 目录下执行以下命令</td>
<td></td>
</tr>
<tr>
<td>ffmpeg -i d:\input.mp4 -o d:\output.avi</td>
<td></td>
</tr>
<tr>
<td>```</td>
<td></td>
</tr>
</tbody></table>
<h4 id="2-2-视频转-Gif-命令"><a href="#2-2-视频转-Gif-命令" class="headerlink" title="2.2 视频转 Gif 命令"></a>2.2 视频转 Gif 命令</h4><table>
<thead>
<tr>
<th>命令参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>源文件</td>
</tr>
<tr>
<td>-ss</td>
<td>从多少秒开始</td>
</tr>
<tr>
<td>-t</td>
<td>到多少秒介绍</td>
</tr>
<tr>
<td>-s</td>
<td>图像的尺寸大小</td>
</tr>
<tr>
<td>-b:v</td>
<td>码率</td>
</tr>
</tbody></table>
<pre><code>//进入到FFmpeg 的 bin 目录下执行以下命令
ffmpeg -ss 5 -t 15 -i d:\\input.mp4 -s 300x200 -b:v 1500K D:\\video_gif.gif</code></pre><h2 id="三、使用-visual-studio-编译-FFmpeg"><a href="#三、使用-visual-studio-编译-FFmpeg" class="headerlink" title="三、使用 visual studio 编译 FFmpeg"></a>三、使用 visual studio 编译 FFmpeg</h2><p>*注：项目根目录即创建cpp源文件所在目录</p>
<p><strong>步骤</strong>：</p>
<ol>
<li>在<a target="_blank" rel="noopener" href="http://ffmpeg.org/">【FFmpeg官网】</a>下载 FFmpeg 在windows 下的开发(dev)版本 <a target="_blank" rel="noopener" href="https://ffmpeg.zeranoe.com/builds/">ffmpeg-XXX-win64-dev</a></li>
<li>在 visual studio上创建一个C++的空项目</li>
<li>将下载好的 FFmpeg 包解压后，复制 include 和 lib 文件夹到刚刚创建好的项目根路径下</li>
<li>下载 FFmpeg 在windows 下的 Shared 版本<a target="_blank" rel="noopener" href="https://ffmpeg.zeranoe.com/builds/">ffmpeg-XXX-win64-shared</a>,解压后赋值 bin 目录下的动态库(.dll)文件到项目根目录下</li>
<li>修改项目的配置管理器中的活动姐姐方案平台为X64(根据自己操作系统位数更改)</li>
<li>在 visual studio 中项目右键，点击【属性（ALT+Enter）】,选中【C++目录】，右侧的【包含目录】，点击编辑，增加刚刚复制到根目录下的 include 目录</li>
</ol>
<p><img src="/images/20190325/c++_include.png" alt="包含目录" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190325/c++_include.png" class="lozad post-image"></p>
<ol start="7">
<li>点击【属性】中的【链接器】，在右侧选中【附加库目录】，点击编辑，增加刚刚复制到根目录下的 lib 目录</li>
</ol>
<p><img src="/images/20190325/lianjie_lib.png" alt="附加库目录" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190325/lianjie_lib.png" class="lozad post-image"></p>
<ol start="8">
<li>点击【属性】中的【链接器】下的【输入】，在右侧选中【附加依赖库】，点击编辑，增加刚刚复制到根目录下的 lib 目录下所有的 .lib 文件</li>
</ol>
<pre><code>avcodec.lib
avdevice.lib
avfilter.lib
avformat.lib
avutil.lib
postproc.lib
swresample.lib
swscale.lib</code></pre><p><img src="/images/20190325/fujiayilai_lib.png" alt="附加库目录" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190325/fujiayilai_lib.png" class="lozad post-image"></p>
<ol start="9">
<li>在项目中添加一个.cpp的源文件，如：my_ffmpeg.cpp</li>
</ol>
<pre><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

//C和C++混编，指示编译器按照C语言进行编译
extern &quot;C&quot;&#123;
//引入ffmpeg的头文件
#include &quot;libavcodec/avcodec.h&quot;
&#125;;

void main() &#123;
    //输出 ffmpeg 的配置
    printf(&quot;%s\n&quot;,avcodec_configuration());

    getchar();
&#125;</code></pre><h2 id="四、使用-Linux主机-编译-FFmpeg"><a href="#四、使用-Linux主机-编译-FFmpeg" class="headerlink" title="四、使用 Linux主机 编译 FFmpeg"></a>四、使用 Linux主机 编译 FFmpeg</h2><h3 id="1、编译前准备"><a href="#1、编译前准备" class="headerlink" title="1、编译前准备"></a>1、编译前准备</h3><ul>
<li>阿里云主机(Ubuntu/centos)</li>
<li>客户端主机安装XShell，Xftp</li>
</ul>
<h3 id="2、编译"><a href="#2、编译" class="headerlink" title="2、编译"></a>2、编译</h3><ul>
<li>使用Xftp将NDK、FFmpeg 上传到阿里云主机</li>
<li>安装vim 编辑器</li>
</ul>
<pre><code>$ apt-get update
$ sudo apt-get install vim-gtk</code></pre><ul>
<li>NDK 安装，配置环境变量</li>
</ul>
<pre><code>//给文件授权可执行
$ chmod 777 -R android-ndk-r10e-linux-x86_64.bin
//执行文件
$ ./android-ndk-r10e-linux-x86_64.bin
//配置环境变量
$ vim ~/.bashrc

//增加环境变量
export NDKROOT=/home/study/ndk/android-ndk-r10e
export PATH=$NDKROOT:$PATH

$ source ~/.bashrc
//查看ndk版本号
$ ndk-build -v</code></pre><ul>
<li>解压 FFmpeg </li>
</ul>
<pre><code>$ tar -xzvf ffmpeg-4.1.2.tar.gz </code></pre><ul>
<li>编译 FFmpeg ,实现 Shell 脚本文件android_build.sh</li>
</ul>
<pre><code>#!/bin/bash
make clean
export NDK=/home/study/ndk/android-ndk-r10e
export SYSROOT=$NDK/platforms/android-9/arch-arm/
export TOOLCHAIN=$NDK/toolchains/arm-linux-androideabi-4.8/prebuilt/linux-x86_64
export CPU=arm
export PREFIX=$(pwd)/android/$CPU
export ADDI_CFLAGS=&quot;-marm&quot;

./configure --target-os=linux \
--prefix=$PREFIX --arch=arm \
--disable-doc \
--enable-shared \
--disable-static \
--disable-yasm \
--disable-symver \
--enable-gpl \
--disable-ffmpeg \
--disable-ffplay \
--disable-ffprobe \
--disable-ffserver \
--disable-doc \
--disable-symver \
--cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \
--enable-cross-compile \
--sysroot=$SYSROOT \
--extra-cflags=&quot;-Os -fpic $ADDI_CFLAGS&quot; \
--extra-ldflags=&quot;$ADDI_LDFLAGS&quot; \
$ADDITIONAL_CONFIGURE_FLAG
make clean
make
make install
</code></pre><p>执行脚本文件</p>
<pre><code>./android_build.sh</code></pre><h2 id="五、使用编译后形成的include和lib目录实现Android-NDK-解码功能"><a href="#五、使用编译后形成的include和lib目录实现Android-NDK-解码功能" class="headerlink" title="五、使用编译后形成的include和lib目录实现Android NDK 解码功能"></a>五、使用编译后形成的include和lib目录实现Android NDK 解码功能</h2><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><ol>
<li>在Android studio上创建一个支持C++的Android项目</li>
<li>将生成的 include 和 lib 复制到 cpp 目录下，更改CMakeLists.txt文件</li>
</ol>
<pre><code>cmake_minimum_required(VERSION 3.4.1)
set(DISTRIBUTION_DIR $&#123;CMAKE_SOURCE_DIR&#125;/../jniLibs/)

add_library( # Sets the name of the library.
        ffmpeg-video
        SHARED
        ffmpeg_video.c)


# 编解码(最重要的库)
add_library(
        avcodec
        SHARED
        IMPORTED
)

#指定编码库的位置
set_target_properties(
        avcodec
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libavcodec-56.so
)

#设备信息
add_library(
        avdevice
        SHARED
        IMPORTED
)

#指定设备信息的位置
set_target_properties(
        avdevice
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libavdevice-56.so
)

#滤镜特效处理库
add_library(
        avfilter
        SHARED
        IMPORTED
)

#指定滤镜库位置
set_target_properties(
        avfilter
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libavfilter-5.so
)

#封装格式处理库
add_library(
        avformat
        SHARED
        IMPORTED
)

#指定格式库路径
set_target_properties(
        avformat
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libavformat-56.so
)

#工具库(大部分库都需要这个库的支持)
add_library(
        avutil
        SHARED
        IMPORTED
)

#指定工具库路径
set_target_properties(
        avutil
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libavutil-54.so
)

#后期处理
add_library(
        postproc
        SHARED
        IMPORTED
)

#指定后期处理库路径
set_target_properties(
        postproc
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libpostproc-53.so
)

#数据格式转换库
add_library(
        swresample
        SHARED
        IMPORTED
)

#指定库位置
set_target_properties(
        swresample
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libswresample-1.so
)

#视频像素数据格式转换
add_library(
        swscale
        SHARED
        IMPORTED
)
#视频像素格式转换库位置
set_target_properties(
        swscale
        PROPERTIES IMPORTED_LOCATION
        $&#123;DISTRIBUTION_DIR&#125;/$&#123;ANDROID_ABI&#125;/libswscale-3.so
)


find_library(
        android-lib
        android
)

find_library(
        log-lib
        log
)

find_library(
        jnigraphics-lib
        jnigraphics
)

# 将预构建库与本地库相连
target_link_libraries(
        ffmpeg-video
        avcodec
        avdevice
        avfilter
        avformat
        avutil
        postproc
        swresample
        swscale
        $&#123;android-lib&#125;
        $&#123;jnigraphics-lib&#125;
        $&#123;log-lib&#125;
)</code></pre><ol start="3">
<li>编写本地 native 方法，编译生成.h头文件</li>
</ol>
<pre><code>package cn.onestravel.ndk.ffmpegdecodedemo;


public class VideoUtils &#123;
    static &#123;
        System.loadLibrary(&quot;avutil-54&quot;);
        System.loadLibrary(&quot;avcodec-56&quot;);
        System.loadLibrary(&quot;avdevice-56&quot;);
        System.loadLibrary(&quot;avfilter-5&quot;);
        System.loadLibrary(&quot;avformat-56&quot;);
        System.loadLibrary(&quot;postproc-53&quot;);
        System.loadLibrary(&quot;swresample-1&quot;);
        System.loadLibrary(&quot;swscale-3&quot;);
        System.loadLibrary(&quot;ffmpeg-video&quot;);
    &#125;
    public native static void decode(String input,String output);
&#125;
</code></pre><ol start="5">
<li>对编译生成.h头文件进行实现，创建ffmpeg_video.c</li>
</ol>
<pre><code>//
// Created by Administrator on 2019/3/27.
//

//
// Created by Administrator on 2019/3/26.
//
#include &lt;android/log.h&gt;
#include &quot;cn_onestravel_ndk_ffmpegdecodedemo_VideoUtils.h&quot;
//编码
#include &quot;include/libavcodec/avcodec.h&quot;
//封装格式处理
#include &quot;include/libavformat/avformat.h&quot;
//像素处理
#include &quot;include/libswscale/swscale.h&quot;
#include &quot;include/libavutil/avutil.h&quot;
#include &quot;include/libavutil/frame.h&quot;

#define LOGI(FORMAT,...) __android_log_print(ANDROID_LOG_INFO,&quot;FFMPEG&quot;,FORMAT,##__VA_ARGS__);
#define LOGE(FORMAT,...) __android_log_print(ANDROID_LOG_ERROR,&quot;FFMPEG&quot;,FORMAT,##__VA_ARGS__);


/*
 * Class:     cn_onestravel_ndk_ffmpegdecode_VoideUtils
 * Method:    decode
 * Signature: (Ljava/lang/String;Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_cn_onestravel_ndk_ffmpegdecodedemo_VideoUtils_decode
  (JNIEnv * env, jclass jcls, jstring input_jstr, jstring output_jstr)&#123;
      //需要转码的视频文件(输入的视频文件)
      const char* input_cstr = (*env)-&gt;GetStringUTFChars(env,input_jstr,NULL);
      const char* output_cstr = (*env)-&gt;GetStringUTFChars(env,output_jstr,NULL);

      //1.注册所有组件
      av_register_all();

      //封装格式上下文，统领全局的结构体，保存了视频文件封装格式的相关信息
      AVFormatContext *pFormatCtx = avformat_alloc_context();

      //2.打开输入视频文件
      if (avformat_open_input(&amp;pFormatCtx, input_cstr, NULL, NULL) != 0)
      &#123;
          LOGE(&quot;%s&quot;,&quot;无法打开输入视频文件&quot;);
          return;
      &#125;

      //3.获取视频文件信息
      if (avformat_find_stream_info(pFormatCtx,NULL) &lt; 0)
      &#123;
          LOGE(&quot;%s&quot;,&quot;无法获取视频文件信息&quot;);
          return;
      &#125;

      //获取视频流的索引位置
      //遍历所有类型的流（音频流、视频流、字幕流），找到视频流
      int v_stream_idx = -1;
      int i = 0;
      //number of streams
      for (; i &lt; pFormatCtx-&gt;nb_streams; i++)
      &#123;
          //流的类型
          if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO)
          &#123;
              v_stream_idx = i;
              break;
          &#125;
      &#125;

      if (v_stream_idx == -1)
      &#123;
          LOGE(&quot;%s&quot;,&quot;找不到视频流\n&quot;);
          return;
      &#125;

      //只有知道视频的编码方式，才能够根据编码方式去找到解码器
      //获取视频流中的编解码上下文
      AVCodecContext *pCodecCtx = pFormatCtx-&gt;streams[v_stream_idx]-&gt;codec;
      //4.根据编解码上下文中的编码id查找对应的解码
      AVCodec *pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id);
      //（迅雷看看，找不到解码器，临时下载一个解码器）
      if (pCodec == NULL)
      &#123;
          LOGE(&quot;%s&quot;,&quot;找不到解码器\n&quot;);
          return;
      &#125;

      //5.打开解码器
      if (avcodec_open2(pCodecCtx,pCodec,NULL)&lt;0)
      &#123;
          LOGE(&quot;%s&quot;,&quot;解码器无法打开\n&quot;);
          return;
      &#125;

      //输出视频信息
      LOGI(&quot;视频的文件格式：%s&quot;,pFormatCtx-&gt;iformat-&gt;name);
      LOGI(&quot;视频时长：%ld&quot;, (pFormatCtx-&gt;duration)/1000000);
      LOGI(&quot;视频的宽高：%d,%d&quot;,pCodecCtx-&gt;width,pCodecCtx-&gt;height);
      LOGI(&quot;解码器的名称：%s&quot;,pCodec-&gt;name);

      //准备读取
      //AVPacket用于存储一帧一帧的压缩数据（H264）
      //缓冲区，开辟空间
      AVPacket *packet = (AVPacket*)av_malloc(sizeof(AVPacket));

      //AVFrame用于存储解码后的像素数据(YUV)
      //内存分配
      AVFrame *pFrame = av_frame_alloc();
      //YUV420
      AVFrame *pFrameYUV = av_frame_alloc();
      //只有指定了AVFrame的像素格式、画面大小才能真正分配内存
      //缓冲区分配内存
      uint8_t *out_buffer = (uint8_t *)av_malloc(avpicture_get_size(AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height));
      //初始化缓冲区
      avpicture_fill((AVPicture *)pFrameYUV, out_buffer, AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height);

      //用于转码（缩放）的参数，转之前的宽高，转之后的宽高，格式等
      struct SwsContext *sws_ctx = sws_getContext(pCodecCtx-&gt;width,pCodecCtx-&gt;height,pCodecCtx-&gt;pix_fmt,
          pCodecCtx-&gt;width, pCodecCtx-&gt;height, AV_PIX_FMT_YUV420P,
          SWS_BICUBIC, NULL, NULL, NULL);


      int got_picture, ret;

      FILE *fp_yuv = fopen(output_cstr, &quot;wb+&quot;);

      int frame_count = 0;

      //6.一帧一帧的读取压缩数据
      while (av_read_frame(pFormatCtx, packet) &gt;= 0)
      &#123;
          //只要视频压缩数据（根据流的索引位置判断）
          if (packet-&gt;stream_index == v_stream_idx)
          &#123;
              //7.解码一帧视频压缩数据，得到视频像素数据
              ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;got_picture, packet);
              if (ret &lt; 0)
              &#123;
                  LOGE(&quot;%s&quot;,&quot;解码错误&quot;);
                  return;
              &#125;

              //为0说明解码完成，非0正在解码
              if (got_picture)
              &#123;
                  //AVFrame转为像素格式YUV420，宽高
                  //2 6输入、输出数据
                  //3 7输入、输出画面一行的数据的大小 AVFrame 转换是一行一行转换的
                  //4 输入数据第一列要转码的位置 从0开始
                  //5 输入画面的高度
                  sws_scale(sws_ctx, pFrame-&gt;data, pFrame-&gt;linesize, 0, pCodecCtx-&gt;height,
                      pFrameYUV-&gt;data, pFrameYUV-&gt;linesize);

                  //输出到YUV文件
                  //AVFrame像素帧写入文件
                  //data解码后的图像像素数据（音频采样数据）
                  //Y 亮度 UV 色度（压缩了） 人对亮度更加敏感
                  //U V 个数是Y的1/4
                  int y_size = pCodecCtx-&gt;width * pCodecCtx-&gt;height;
                  fwrite(pFrameYUV-&gt;data[0], 1, y_size, fp_yuv);
                  fwrite(pFrameYUV-&gt;data[1], 1, y_size / 4, fp_yuv);
                  fwrite(pFrameYUV-&gt;data[2], 1, y_size / 4, fp_yuv);

                  frame_count++;
                  LOGI(&quot;解码第%d帧&quot;,frame_count);
              &#125;
          &#125;

          //释放资源
          av_free_packet(packet);
      &#125;

      fclose(fp_yuv);

      (*env)-&gt;ReleaseStringUTFChars(env,input_jstr,input_cstr);
      (*env)-&gt;ReleaseStringUTFChars(env,output_jstr,output_cstr);

      av_frame_free(&amp;pFrame);

      avcodec_close(pCodecCtx);

      avformat_free_context(pFormatCtx);

  &#125;</code></pre><ol start="5">
<li>Activity 实现</li>
</ol>
<pre><code>public class MainActivity extends AppCompatActivity &#123;


    private boolean permission;
    private VideoThread videoThread;

    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        requestPermission();
        videoThread = new VideoThread();
    &#125;

    /**
     * 获取权限
     */
    private void requestPermission() &#123;
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;
            String[] perms = &#123;&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;&#125;;
            if (checkSelfPermission(perms[0]) == PackageManager.PERMISSION_DENIED) &#123;
                permission = false;
                requestPermissions(perms, 200);
            &#125; else &#123;
                permission = true;
            &#125;
        &#125;
    &#125;

    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) &#123;
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == 200) &#123;
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) &#123;
                permission = true;
            &#125;
        &#125;
    &#125;

    public void decode(View view) &#123;
        if (!permission) &#123;
            Toast.makeText(this, &quot;请允许存储权限&quot;, Toast.LENGTH_SHORT).show();
            requestPermission();
            return;
        &#125;
        if (videoThread == null) &#123;
            videoThread = new VideoThread();
        &#125;
        try &#123;
            if(!videoThread.isAlive()) &#123;
                videoThread.start();
            &#125;
        &#125;catch (Exception e)&#123;
            e.printStackTrace();
        &#125;

    &#125;


    @Override
    protected void onDestroy() &#123;
        videoThread = null;
        super.onDestroy();
    &#125;

    public static class VideoThread extends Thread &#123;
        @Override
        public void run() &#123;
            super.run();
            String input = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/input.mp4&quot;;
            String output = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/out.yuv&quot;;
            VideoUtils.decode(input, output);
            Log.i(&quot;Activity&quot;,&quot;编码完成&quot;);
        &#125;
    &#125;
&#125;

</code></pre><ol start="6">
<li>运行程序，安装到手机，进行解码成 yuv</li>
</ol>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/about">一个人的旅行</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/20190325/0bf1498a9d8f/">https://blog.onestravel.cn/20190325/0bf1498a9d8f/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/20190325/332142e2a50e/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">矩阵中的路径 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/20190320/0aa2fc6b4c9c/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">旋转数组的最小数字 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content comment-card" style="margin-top: 16px;">
  <div class="comment-card-title">评论</div>
  
  <div id="gitalk-container"></div>
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

  
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  
<script src="/js/lib/md5.min.js"></script>

  <script>
    var gitalk = new Gitalk({
      clientID: 'a52a65db0a634019e27f',
      clientSecret: 'a04eaebc103e73d3769221171a4b87b55b39998d',
      repo: 'onestravel.github.io',
      owner: 'onestravel',
      admin: "onestravel",
      id: md5(location.href),
      distractionFreeMode: true,
      language: 'navigator.language || navigator.userLanguage',
      labels: ["Gitalk"],
      perPage: 10
    })

    gitalk.render('gitalk-container')
  </script>

</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%90FFmpeg%E3%80%91-%E4%B8%80-%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%BB%A5%E5%8F%8AFFmpeg%E4%BB%8B%E7%BB%8D"><span class="toc-text">【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">一、音视频相关基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-text">1、视频播放器原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%A3%E5%B0%81%E8%A3%85"><span class="toc-text">1.1 解封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2 解码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E9%9F%B3%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.1 音频压缩数据解码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.2 视频压缩数据解码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%8C%E6%AD%A5"><span class="toc-text">1.3 音视频同步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81FFmpeg-%E4%BB%8B%E7%BB%8D"><span class="toc-text">二、FFmpeg 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89"><span class="toc-text">1、定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81FFmpeg-%E5%91%BD%E4%BB%A4"><span class="toc-text">2、FFmpeg 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%86%E9%A2%91%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1 视频格式转换命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A7%86%E9%A2%91%E8%BD%AC-Gif-%E5%91%BD%E4%BB%A4"><span class="toc-text">2.2 视频转 Gif 命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8-visual-studio-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">三、使用 visual studio 编译 FFmpeg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8-Linux%E4%B8%BB%E6%9C%BA-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">四、使用 Linux主机 编译 FFmpeg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E8%AF%91%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-text">1、编译前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E8%AF%91"><span class="toc-text">2、编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%90%8E%E5%BD%A2%E6%88%90%E7%9A%84include%E5%92%8Clib%E7%9B%AE%E5%BD%95%E5%AE%9E%E7%8E%B0Android-NDK-%E8%A7%A3%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="toc-text">五、使用编译后形成的include和lib目录实现Android NDK 解码功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-text">步骤：</span></a></li></ol></li></ol></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/medias/avatar.jpg" class="author-img">

<p class="author-name">一个人的旅行</p>
<p class="author-description">冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>69</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>14</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>47</span>
    <span>标签</span>
  </a>
</div>

<div class="author-card-society">
  
    <div class="author-card-society-icon">
      <a target="_blank" rel="noopener" href="https://github.com/onestravel">
        <i class="iconfont icon-github society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a href="mailto:service@onestravel.cn">
        <i class="iconfont icon-mail society-icon"></i>
      </a>
    </div>
  
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%90FFmpeg%E3%80%91-%E4%B8%80-%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%BB%A5%E5%8F%8AFFmpeg%E4%BB%8B%E7%BB%8D"><span class="toc-text">【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">一、音视频相关基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-text">1、视频播放器原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%A3%E5%B0%81%E8%A3%85"><span class="toc-text">1.1 解封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2 解码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E9%9F%B3%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.1 音频压缩数据解码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.2 视频压缩数据解码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%8C%E6%AD%A5"><span class="toc-text">1.3 音视频同步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81FFmpeg-%E4%BB%8B%E7%BB%8D"><span class="toc-text">二、FFmpeg 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89"><span class="toc-text">1、定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81FFmpeg-%E5%91%BD%E4%BB%A4"><span class="toc-text">2、FFmpeg 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%86%E9%A2%91%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1 视频格式转换命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A7%86%E9%A2%91%E8%BD%AC-Gif-%E5%91%BD%E4%BB%A4"><span class="toc-text">2.2 视频转 Gif 命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8-visual-studio-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">三、使用 visual studio 编译 FFmpeg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8-Linux%E4%B8%BB%E6%9C%BA-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">四、使用 Linux主机 编译 FFmpeg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E8%AF%91%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-text">1、编译前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E8%AF%91"><span class="toc-text">2、编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%90%8E%E5%BD%A2%E6%88%90%E7%9A%84include%E5%92%8Clib%E7%9B%AE%E5%BD%95%E5%AE%9E%E7%8E%B0Android-NDK-%E8%A7%A3%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="toc-text">五、使用编译后形成的include和lib目录实现Android NDK 解码功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-text">步骤：</span></a></li></ol></li></ol></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
      <a href="/categories/NDK/">
        <div class="categories-list-item">
          NDK
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Android/">
        <div class="categories-list-item">
          Android
          <span class="categories-list-item-badge">9</span>
        </div>
      </a>
    
      <a href="/categories/CPlusPlus/">
        <div class="categories-list-item">
          CPlusPlus
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/C/">
        <div class="categories-list-item">
          C
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/前端H5/">
        <div class="categories-list-item">
          前端H5
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/JNI/">
        <div class="categories-list-item">
          JNI
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/算法/">
        <div class="categories-list-item">
          算法
          <span class="categories-list-item-badge">18</span>
        </div>
      </a>
    
      <a href="/categories/DevTools/">
        <div class="categories-list-item">
          DevTools
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/SpringBoot/">
        <div class="categories-list-item">
          SpringBoot
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Jenkins/">
        <div class="categories-list-item">
          Jenkins
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Kotlin/">
        <div class="categories-list-item">
          Kotlin
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/Linux/">
        <div class="categories-list-item">
          Linux
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/JAVA/">
        <div class="categories-list-item">
          JAVA
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Git/">
        <div class="categories-list-item">
          Git
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
    <a href="/tags/Android/" title="Android"><div class="tags-list-item">Android</div></a>
    
    <a href="/tags/Kotlin/" title="Kotlin"><div class="tags-list-item">Kotlin</div></a>
    
    <a href="/tags/CPlusPlus/" title="CPlusPlus"><div class="tags-list-item">CPlusPlus</div></a>
    
    <a href="/tags/NDK/" title="NDK"><div class="tags-list-item">NDK</div></a>
    
    <a href="/tags/C/" title="C"><div class="tags-list-item">C</div></a>
    
    <a href="/tags/JVM/" title="JVM"><div class="tags-list-item">JVM</div></a>
    
    <a href="/tags/数组/" title="数组"><div class="tags-list-item">数组</div></a>
    
    <a href="/tags/自动化部署/" title="自动化部署"><div class="tags-list-item">自动化部署</div></a>
    
    <a href="/tags/Jenkins/" title="Jenkins"><div class="tags-list-item">Jenkins</div></a>
    
    <a href="/tags/斐波那契数列/" title="斐波那契数列"><div class="tags-list-item">斐波那契数列</div></a>
    
    <a href="/tags/Intellij-IDEA/" title="Intellij IDEA"><div class="tags-list-item">Intellij IDEA</div></a>
    
    <a href="/tags/html/" title="html"><div class="tags-list-item">html</div></a>
    
    <a href="/tags/JNI/" title="JNI"><div class="tags-list-item">JNI</div></a>
    
    <a href="/tags/Linux/" title="Linux"><div class="tags-list-item">Linux</div></a>
    
    <a href="/tags/矩阵/" title="矩阵"><div class="tags-list-item">矩阵</div></a>
    
    <a href="/tags/centos/" title="centos"><div class="tags-list-item">centos</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E3%80%90FFmpeg%E3%80%91-%E4%B8%80-%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%BB%A5%E5%8F%8AFFmpeg%E4%BB%8B%E7%BB%8D"><span class="toc-text">【FFmpeg】(一) 音视频相关基础知识以及FFmpeg介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%9F%B3%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">一、音视频相关基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-text">1、视频播放器原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E8%A7%A3%E5%B0%81%E8%A3%85"><span class="toc-text">1.1 解封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2 解码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E9%9F%B3%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.1 音频压缩数据解码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9%E6%95%B0%E6%8D%AE%E8%A7%A3%E7%A0%81"><span class="toc-text">1.2.2 视频压缩数据解码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%90%8C%E6%AD%A5"><span class="toc-text">1.3 音视频同步</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81FFmpeg-%E4%BB%8B%E7%BB%8D"><span class="toc-text">二、FFmpeg 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9A%E4%B9%89"><span class="toc-text">1、定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81FFmpeg-%E5%91%BD%E4%BB%A4"><span class="toc-text">2、FFmpeg 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A7%86%E9%A2%91%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1 视频格式转换命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A7%86%E9%A2%91%E8%BD%AC-Gif-%E5%91%BD%E4%BB%A4"><span class="toc-text">2.2 视频转 Gif 命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8-visual-studio-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">三、使用 visual studio 编译 FFmpeg</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8-Linux%E4%B8%BB%E6%9C%BA-%E7%BC%96%E8%AF%91-FFmpeg"><span class="toc-text">四、使用 Linux主机 编译 FFmpeg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E8%AF%91%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-text">1、编译前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E8%AF%91"><span class="toc-text">2、编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%90%8E%E5%BD%A2%E6%88%90%E7%9A%84include%E5%92%8Clib%E7%9B%AE%E5%BD%95%E5%AE%9E%E7%8E%B0Android-NDK-%E8%A7%A3%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="toc-text">五、使用编译后形成的include和lib目录实现Android NDK 解码功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-text">步骤：</span></a></li></ol></li></ol></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-09-20</div>
        <a href="/20210920/f8c53c115779/"><div class="recent-posts-item-content">【并发编程】线程基础</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-07-28</div>
        <a href="/20210728/9c2efe6aefcb/"><div class="recent-posts-item-content">【笔记四】编译插桩操纵字节码，实现不可能完成的任务</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-05-28</div>
        <a href="/20210528/618470f841d8/"><div class="recent-posts-item-content">【笔记三】字节码层面分析 class 文件结构</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-03-28</div>
        <a href="/20210328/68b72d473df5/"><div class="recent-posts-item-content">【笔记二】GC 回收机制和分代回收策略</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2022
        </span>
        &nbsp;
        <a href="/" class="footer-link">一个人的旅行 </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
      <div class="footer-dsc">
        
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
        <span>&nbsp;|&nbsp;</span>
        
        
        本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton"  aria-label="回到顶部">
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton" aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget" aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget" aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  

  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('aria-label', 'illustration');
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      if (img[i].alt) wrapper.dataset.caption = img[i].alt;
      wrapper.dataset.nolink = true;
      img[i].before(wrapper);
      wrapper.append(img[i]);
      var divWrap = document.createElement('div');
      divWrap.classList.add('gallery');
      wrapper.before(divWrap);
      divWrap.append(wrapper);
    }
    baguetteBox.run('.gallery');
  }
</script>
<script>loadScript("/js/lib/lightbox/baguetteBox.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  <script>loadScript("/js/lib/busuanzi.min.js")</script>
  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
  <script>
    var googleAnalytics = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-145377665-1');
    }
  </script>
  <script>loadScript("https://www.googletagmanager.com/gtag/js?id=" + "UA-145377665-1", googleAnalytics)</script>
  
</body>

</html>