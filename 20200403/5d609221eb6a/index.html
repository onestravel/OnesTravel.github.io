<!DOCTYPE html>
<html  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <meta name="description" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  <link rel="icon" href="/favicon.png">
  <title>Glide-4.11.0 浅析</title>
  
  
  <meta property="og:title" content="Glide-4.11.0 浅析">
  
  
  <meta property="og:url" content="https://blog.onestravel.cn/20200403/5d609221eb6a/index.html">
  
  
  <meta property="og:img" content="/images/2020-04-03/glide.jpg">
  
  
  <meta property="og:img" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2020-04-03">
  <meta property="og:article:modified_time" content="2022-10-08">
  <meta property="og:article:author" content="一个人的旅行">
  
  
  <meta property="og:article:tag" content="Android">
  
  <meta property="og:article:tag" content="glide">
  
  <meta property="og:article:tag" content="code">
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" as="script">
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" as="script">
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
<link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/favicon.png" alt="logo">
      
      <span class="navbar-logo-dsc">一个人的旅行</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于
    
    </a>
    
    <a href="/friends" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<div class="image-wrapper">
  <img src="/images/2020-04-03/glide.jpg" data-src="/images/2020-04-03/glide.jpg"
    srcset="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20300%20300&#39;%3E%3C/svg%3E"
    class="image lozad"
    alt="thumbnail"
  >
</div>

<article class="card card-content">
  <header>
    <h1 class="post-title">
      Glide-4.11.0 浅析
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2020-04-03T05:00:00.000Z">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2020-04-03</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/Android/" class="post-meta-link">Android</a>
    
    
    
    <span class="dot"></span>
    <span>8.7k 字</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/Android/" class="post-meta-link">Android</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/glide/" class="post-meta-link">glide</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/code/" class="post-meta-link">code</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <h1 id="Glide-4-11-0-浅析"><a href="#Glide-4-11-0-浅析" class="headerlink" title="Glide-4.11.0 浅析"></a>Glide-4.11.0 浅析</h1><p>Glide 是Google推荐使用的图片加载框架，在开发过程中我们也会经常使用到，使用起来也比较简单，一般一行代码就可以完成图片加载；如：</p>
<pre class=" language-java"><code class="language-java">Glide<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>mThumbIv<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>mThumbIv<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>今天我们来阅读一下Glide的源码，了解一下Glide 加载图标的原理，我们今天阅读的Glide源码是Glide:4.11.0版本的，是当前最新版本。源码获取地址为 <code>https://github.com/bumptech/glide/releases/tag/v4.11.0</code>。</p>
<p>源码的阅读，是比较枯燥的；但是掌握了阅读代码的方法之后，一个人，一杯茶，一个电脑，也是一种特别的享受。</p>
<p>开始阅读代码</p>
<p>上面说了Glide加载的方法，一般使用时，在load之前，我们还会有其他的一些设置想，但是总体来说Glide加载图片就可以分为三步，第一步：<code>with</code>,第二步：<code>load</code>,第三步：<code>into</code>，接下来我们就从这三步来阅读代码</p>
<h3 id="1-with"><a href="#1-with" class="headerlink" title="1. with"></a>1. with</h3><p><code>Glide.with(context)</code> ;<code>with</code>是Glide类的静态方法，在 Glide类中有多个<code>with</code>方法的重载，代码如下：</p>
<pre class=" language-Java"><code class="language-Java">@NonNull
public static RequestManager with(@NonNull Context context) {
  return getRetriever(context).get(context);
}


@NonNull
public static RequestManager with(@NonNull Activity activity) {
  return getRetriever(activity).get(activity);
}


@NonNull
public static RequestManager with(@NonNull FragmentActivity activity) {
  return getRetriever(activity).get(activity);
}


@NonNull
public static RequestManager with(@NonNull androidx.fragment.app.Fragment fragment) {
  return getRetriever(fragment.getContext()).get(fragment);
}


@SuppressWarnings("deprecation")
@Deprecated
@NonNull
public static RequestManager with(@NonNull android.app.Fragment fragment) {
  return getRetriever(fragment.getActivity()).get(fragment);
}

@NonNull
public static RequestManager with(@NonNull View view) {
  return getRetriever(view.getContext()).get(view);
}</code></pre>
<p>从上面代码中，我们可以看到，在调用<code>Glide.with</code>方法时，我们可以传入的参数有Context,Activity,FragmentActivity,androidx包下的Fragment和android包下的Fragment,View,无论传入什么参数，最终都调用了<code>getRetriever().get()</code>方法来返回了<code>RequestManager</code>对象;</p>
<p>我们来看一下 <code>getRetriever()</code>方法的源码，</p>
<pre class=" language-Java"><code class="language-Java">@NonNull
private static RequestManagerRetriever getRetriever(@Nullable Context context) {
  // Context could be null for other reasons (ie the user passes in null), but in practice it will
  // only occur due to errors with the Fragment lifecycle.
  Preconditions.checkNotNull(
      context,
      "You cannot start a load on a not yet attached View or a Fragment where getActivity() "
          + "returns null (which usually occurs when getActivity() is called before the Fragment "
          + "is attached or after the Fragment is destroyed).");
  return Glide.get(context).getRequestManagerRetriever();
}</code></pre>
<p><code>getRetriever()</code>方法时通过调用Glide 类的get()方法来获取Glide的单例对象。然后通过初始化之后的Glide对象，获取<code>RequestManagerRetriever</code>对象；所以<code>getRetriever()</code>方法最终返回了一个<code>RequestManagerRetriever</code>对象。</p>
<p><code>with</code> 方法中，在调用<code>getRetriever()</code>方法，拿到<code>RequestManagerRetriever</code>对象之后，调用了他的get()方法。传入了with方法传入的参数。我们来看一下<code>RequestManagerRetriever</code>对象中的get方法：</p>
<pre class=" language-Java"><code class="language-Java">public RequestManagerRetriever(@Nullable RequestManagerFactory factory) {
    this.factory = factory != null ? factory : DEFAULT_FACTORY;
    handler = new Handler(Looper.getMainLooper(), this /* Callback */);
  }

  @NonNull
  private RequestManager getApplicationManager(@NonNull Context context) {
    // Either an application context or we're on a background thread.
    if (applicationManager == null) {
      synchronized (this) {
        if (applicationManager == null) {
          // Normally pause/resume is taken care of by the fragment we add to the fragment or
          // activity. However, in this case since the manager attached to the application will not
          // receive lifecycle events, we must force the manager to start resumed using
          // ApplicationLifecycle.

          // TODO(b/27524013): Factor out this Glide.get() call.
          Glide glide = Glide.get(context.getApplicationContext());
          applicationManager =
              factory.build(
                  glide,
                  new ApplicationLifecycle(),
                  new EmptyRequestManagerTreeNode(),
                  context.getApplicationContext());
        }
      }
    }
    return applicationManager;
  }

  @NonNull
  public RequestManager get(@NonNull Context context) {
    if (context == null) {
      throw new IllegalArgumentException("You cannot start a load on a null Context");
    } else if (Util.isOnMainThread() && !(context instanceof Application)) {
      if (context instanceof FragmentActivity) {
        return get((FragmentActivity) context);
      } else if (context instanceof Activity) {
        return get((Activity) context);
      } else if (context instanceof ContextWrapper
          // Only unwrap a ContextWrapper if the baseContext has a non-null application context.
          // Context#createPackageContext may return a Context without an Application instance,
          // in which case a ContextWrapper may be used to attach one.
          && ((ContextWrapper) context).getBaseContext().getApplicationContext() != null) {
        return get(((ContextWrapper) context).getBaseContext());
      }
    }

    return getApplicationManager(context);
  }

  @NonNull
  public RequestManager get(@NonNull FragmentActivity activity) {
    if (Util.isOnBackgroundThread()) {
      return get(activity.getApplicationContext());
    } else {
      assertNotDestroyed(activity);
      FragmentManager fm = activity.getSupportFragmentManager();
      return supportFragmentGet(activity, fm, /*parentHint=*/ null, isActivityVisible(activity));
    }
  }

  @NonNull
  public RequestManager get(@NonNull Fragment fragment) {
    Preconditions.checkNotNull(
        fragment.getContext(),
        "You cannot start a load on a fragment before it is attached or after it is destroyed");
    if (Util.isOnBackgroundThread()) {
      return get(fragment.getContext().getApplicationContext());
    } else {
      FragmentManager fm = fragment.getChildFragmentManager();
      return supportFragmentGet(fragment.getContext(), fm, fragment, fragment.isVisible());
    }
  }

  @SuppressWarnings("deprecation")
  @NonNull
  public RequestManager get(@NonNull Activity activity) {
    if (Util.isOnBackgroundThread()) {
      return get(activity.getApplicationContext());
    } else {
      assertNotDestroyed(activity);
      android.app.FragmentManager fm = activity.getFragmentManager();
      return fragmentGet(activity, fm, /*parentHint=*/ null, isActivityVisible(activity));
    }
  }

  @SuppressWarnings("deprecation")
  @NonNull
  public RequestManager get(@NonNull View view) {
    if (Util.isOnBackgroundThread()) {
      return get(view.getContext().getApplicationContext());
    }

    Preconditions.checkNotNull(view);
    Preconditions.checkNotNull(
        view.getContext(), "Unable to obtain a request manager for a view without a Context");
    Activity activity = findActivity(view.getContext());
    // The view might be somewhere else, like a service.
    if (activity == null) {
      return get(view.getContext().getApplicationContext());
    }

    if (activity instanceof FragmentActivity) {
      Fragment fragment = findSupportFragment(view, (FragmentActivity) activity);
      return fragment != null ? get(fragment) : get((FragmentActivity) activity);
    }

    // Standard Fragments.
    android.app.Fragment fragment = findFragment(view, activity);
    if (fragment == null) {
      return get(activity);
    }
    return get(fragment);
  }

  private static void findAllSupportFragmentsWithViews(
      @Nullable Collection<Fragment> topLevelFragments, @NonNull Map<View, Fragment> result) {
    if (topLevelFragments == null) {
      return;
    }
    for (Fragment fragment : topLevelFragments) {
      // getFragment()s in the support FragmentManager may contain null values, see #1991.
      if (fragment == null || fragment.getView() == null) {
        continue;
      }
      result.put(fragment.getView(), fragment);
      findAllSupportFragmentsWithViews(fragment.getChildFragmentManager().getFragments(), result);
    }
  }

  @Nullable
  private Fragment findSupportFragment(@NonNull View target, @NonNull FragmentActivity activity) {
    tempViewToSupportFragment.clear();
    findAllSupportFragmentsWithViews(
        activity.getSupportFragmentManager().getFragments(), tempViewToSupportFragment);
    Fragment result = null;
    View activityRoot = activity.findViewById(android.R.id.content);
    View current = target;
    while (!current.equals(activityRoot)) {
      result = tempViewToSupportFragment.get(current);
      if (result != null) {
        break;
      }
      if (current.getParent() instanceof View) {
        current = (View) current.getParent();
      } else {
        break;
      }
    }

    tempViewToSupportFragment.clear();
    return result;
  }

  @SuppressWarnings({"deprecation", "DeprecatedIsStillUsed"})
  @Deprecated
  @Nullable
  private android.app.Fragment findFragment(@NonNull View target, @NonNull Activity activity) {
    tempViewToFragment.clear();
    findAllFragmentsWithViews(activity.getFragmentManager(), tempViewToFragment);

    android.app.Fragment result = null;

    View activityRoot = activity.findViewById(android.R.id.content);
    View current = target;
    while (!current.equals(activityRoot)) {
      result = tempViewToFragment.get(current);
      if (result != null) {
        break;
      }
      if (current.getParent() instanceof View) {
        current = (View) current.getParent();
      } else {
        break;
      }
    }
    tempViewToFragment.clear();
    return result;
  }

  // TODO: Consider using an accessor class in the support library package to more directly retrieve
  // non-support Fragments.
  @SuppressWarnings("deprecation")
  @Deprecated
  @TargetApi(Build.VERSION_CODES.O)
  private void findAllFragmentsWithViews(
      @NonNull android.app.FragmentManager fragmentManager,
      @NonNull ArrayMap<View, android.app.Fragment> result) {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
      for (android.app.Fragment fragment : fragmentManager.getFragments()) {
        if (fragment.getView() != null) {
          result.put(fragment.getView(), fragment);
          findAllFragmentsWithViews(fragment.getChildFragmentManager(), result);
        }
      }
    } else {
      findAllFragmentsWithViewsPreO(fragmentManager, result);
    }
  }

  @SuppressWarnings("deprecation")
  @Deprecated
  private void findAllFragmentsWithViewsPreO(
      @NonNull android.app.FragmentManager fragmentManager,
      @NonNull ArrayMap<View, android.app.Fragment> result) {
    int index = 0;
    while (true) {
      tempBundle.putInt(FRAGMENT_INDEX_KEY, index++);
      android.app.Fragment fragment = null;
      try {
        fragment = fragmentManager.getFragment(tempBundle, FRAGMENT_INDEX_KEY);
      } catch (Exception e) {
        // This generates log spam from FragmentManager anyway.
      }
      if (fragment == null) {
        break;
      }
      if (fragment.getView() != null) {
        result.put(fragment.getView(), fragment);
        if (VERSION.SDK_INT >= VERSION_CODES.JELLY_BEAN_MR1) {
          findAllFragmentsWithViews(fragment.getChildFragmentManager(), result);
        }
      }
    }
  }

  @Nullable
  private static Activity findActivity(@NonNull Context context) {
    if (context instanceof Activity) {
      return (Activity) context;
    } else if (context instanceof ContextWrapper) {
      return findActivity(((ContextWrapper) context).getBaseContext());
    } else {
      return null;
    }
  }

  @TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)
  private static void assertNotDestroyed(@NonNull Activity activity) {
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1 && activity.isDestroyed()) {
      throw new IllegalArgumentException("You cannot start a load for a destroyed activity");
    }
  }

  @SuppressWarnings("deprecation")
  @Deprecated
  @NonNull
  @TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)
  public RequestManager get(@NonNull android.app.Fragment fragment) {
    if (fragment.getActivity() == null) {
      throw new IllegalArgumentException(
          "You cannot start a load on a fragment before it is attached");
    }
    if (Util.isOnBackgroundThread() || Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR1) {
      return get(fragment.getActivity().getApplicationContext());
    } else {
      android.app.FragmentManager fm = fragment.getChildFragmentManager();
      return fragmentGet(fragment.getActivity(), fm, fragment, fragment.isVisible());
    }
  }

  @SuppressWarnings("deprecation")
  @Deprecated
  @NonNull
  RequestManagerFragment getRequestManagerFragment(Activity activity) {
    return getRequestManagerFragment(
        activity.getFragmentManager(), /*parentHint=*/ null, isActivityVisible(activity));
  }

  @SuppressWarnings("deprecation")
  @NonNull
  private RequestManagerFragment getRequestManagerFragment(
      @NonNull final android.app.FragmentManager fm,
      @Nullable android.app.Fragment parentHint,
      boolean isParentVisible) {
    RequestManagerFragment current = (RequestManagerFragment) fm.findFragmentByTag(FRAGMENT_TAG);
    if (current == null) {
      current = pendingRequestManagerFragments.get(fm);
      if (current == null) {
        current = new RequestManagerFragment();
        current.setParentFragmentHint(parentHint);
        if (isParentVisible) {
          current.getGlideLifecycle().onStart();
        }
        pendingRequestManagerFragments.put(fm, current);
        fm.beginTransaction().add(current, FRAGMENT_TAG).commitAllowingStateLoss();
        handler.obtainMessage(ID_REMOVE_FRAGMENT_MANAGER, fm).sendToTarget();
      }
    }
    return current;
  }

  @SuppressWarnings({"deprecation", "DeprecatedIsStillUsed"})
  @Deprecated
  @NonNull
  private RequestManager fragmentGet(
      @NonNull Context context,
      @NonNull android.app.FragmentManager fm,
      @Nullable android.app.Fragment parentHint,
      boolean isParentVisible) {
    RequestManagerFragment current = getRequestManagerFragment(fm, parentHint, isParentVisible);
    RequestManager requestManager = current.getRequestManager();
    if (requestManager == null) {
      // TODO(b/27524013): Factor out this Glide.get() call.
      Glide glide = Glide.get(context);
      requestManager =
          factory.build(
              glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);
      current.setRequestManager(requestManager);
    }
    return requestManager;
  }

  @NonNull
  SupportRequestManagerFragment getSupportRequestManagerFragment(
      Context context, FragmentManager fragmentManager) {
    return getSupportRequestManagerFragment(
        fragmentManager, /*parentHint=*/ null, isActivityVisible(context));
  }

  private static boolean isActivityVisible(Context context) {
    // This is a poor heuristic, but it's about all we have. We'd rather err on the side of visible
    // and start requests than on the side of invisible and ignore valid requests.
    Activity activity = findActivity(context);
    return activity == null || !activity.isFinishing();
  }

  @NonNull
  private SupportRequestManagerFragment getSupportRequestManagerFragment(
      @NonNull final FragmentManager fm, @Nullable Fragment parentHint, boolean isParentVisible) {
    SupportRequestManagerFragment current =
        (SupportRequestManagerFragment) fm.findFragmentByTag(FRAGMENT_TAG);
    if (current == null) {
      current = pendingSupportRequestManagerFragments.get(fm);
      if (current == null) {
        current = new SupportRequestManagerFragment();
        current.setParentFragmentHint(parentHint);
        if (isParentVisible) {
          current.getGlideLifecycle().onStart();
        }
        pendingSupportRequestManagerFragments.put(fm, current);
        fm.beginTransaction().add(current, FRAGMENT_TAG).commitAllowingStateLoss();
        handler.obtainMessage(ID_REMOVE_SUPPORT_FRAGMENT_MANAGER, fm).sendToTarget();
      }
    }
    return current;
  }

  @NonNull
  private RequestManager supportFragmentGet(
      @NonNull Context context,
      @NonNull FragmentManager fm,
      @Nullable Fragment parentHint,
      boolean isParentVisible) {
    SupportRequestManagerFragment current =
        getSupportRequestManagerFragment(fm, parentHint, isParentVisible);
    RequestManager requestManager = current.getRequestManager();
    if (requestManager == null) {
      // TODO(b/27524013): Factor out this Glide.get() call.
      Glide glide = Glide.get(context);
      requestManager =
          factory.build(
              glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);
      current.setRequestManager(requestManager);
    }
    return requestManager;
  }

  @Override
  public boolean handleMessage(Message message) {
    boolean handled = true;
    Object removed = null;
    Object key = null;
    switch (message.what) {
      case ID_REMOVE_FRAGMENT_MANAGER:
        android.app.FragmentManager fm = (android.app.FragmentManager) message.obj;
        key = fm;
        removed = pendingRequestManagerFragments.remove(fm);
        break;
      case ID_REMOVE_SUPPORT_FRAGMENT_MANAGER:
        FragmentManager supportFm = (FragmentManager) message.obj;
        key = supportFm;
        removed = pendingSupportRequestManagerFragments.remove(supportFm);
        break;
      default:
        handled = false;
        break;
    }
    if (handled && removed == null && Log.isLoggable(TAG, Log.WARN)) {
      Log.w(TAG, "Failed to remove expected request manager fragment, manager: " + key);
    }
    return handled;
  }

  /** Used internally to create {@link RequestManager}s. */
  public interface RequestManagerFactory {
    @NonNull
    RequestManager build(
        @NonNull Glide glide,
        @NonNull Lifecycle lifecycle,
        @NonNull RequestManagerTreeNode requestManagerTreeNode,
        @NonNull Context context);
  }

  private static final RequestManagerFactory DEFAULT_FACTORY =
      new RequestManagerFactory() {
        @NonNull
        @Override
        public RequestManager build(
            @NonNull Glide glide,
            @NonNull Lifecycle lifecycle,
            @NonNull RequestManagerTreeNode requestManagerTreeNode,
            @NonNull Context context) {
          return new RequestManager(glide, lifecycle, requestManagerTreeNode, context);
        }
      };
}
</code></pre>
<p>从第33行，我们可以看到，在该<code>get()</code>方法中，根据<code>Context</code>类型，整体分为两类，一类是非<code>Application</code>的Context，一类是<code>Application</code>的Context，<code>Application</code>的Context，直接执行第7行<code>getApplicationManager(context)</code>方法，来创建和<code>Application</code>同生命周期的<code>RequestManager</code>对象；当应用关闭后，Glide也就停止加载；</p>
<p>传入非<code>Application</code>的Context，无论实Activity,Fragment,最终都是根据是否是<code>FragmentActivity</code>的子类或者<code>Activity</code>的子类来创建一个隐藏的<code>SupportRequestManagerFragment</code>  或 <code>RequestManagerFragment</code>对象（第302行和第356行），该对象继承自Fragment；来实现对应的Activity的生命周期的控制；当该Activity销毁时，对应的Glide也停止加载。</p>
<p>总体来说：<code>with</code>方法就是创建一个<code>RequestManager</code> 对象，然后根据传入的context来控制图片加载的生命周期</p>
<h3 id="2-load"><a href="#2-load" class="headerlink" title="2. load"></a>2. load</h3><p>接下来我们来看<code>load</code>方法，在上一步中，我们通过<code>with</code>方法，获取到了<code>RequestManager</code> 对象；那么<code>load</code>方法，就在<code>RequestManager</code>类中，我们来看一下<code>RequestManager</code>类</p>
<pre class=" language-java"><code class="language-java">  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Bitmap<span class="token operator">></span> <span class="token function">asBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">as</span><span class="token punctuation">(</span>Bitmap<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>DECODE_TYPE_BITMAP<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>GifDrawable<span class="token operator">></span> <span class="token function">asGif</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">as</span><span class="token punctuation">(</span>GifDrawable<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>DECODE_TYPE_GIF<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">as</span><span class="token punctuation">(</span>Drawable<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Bitmap bitmap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Drawable drawable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> String string<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Uri uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> File file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"deprecation"</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RawRes</span> <span class="token annotation punctuation">@DrawableRes</span> <span class="token annotation punctuation">@Nullable</span> Integer resourceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>resourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"deprecation"</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token annotation punctuation">@Deprecated</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> URL url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>Drawable<span class="token operator">></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Object model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>File<span class="token operator">></span> <span class="token function">downloadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">as</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>DOWNLOAD_ONLY_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>File<span class="token operator">></span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Object model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">downloadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> RequestBuilder<span class="token operator">&lt;</span>File<span class="token operator">></span> <span class="token function">asFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">as</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token function">skipMemoryCacheOf</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@NonNull</span>
  <span class="token annotation punctuation">@CheckResult</span>
  <span class="token keyword">public</span> <span class="token operator">&lt;</span>ResourceType<span class="token operator">></span> RequestBuilder<span class="token operator">&lt;</span>ResourceType<span class="token operator">></span> <span class="token function">as</span><span class="token punctuation">(</span>
      <span class="token annotation punctuation">@NonNull</span> Class<span class="token operator">&lt;</span>ResourceType<span class="token operator">></span> resourceClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestBuilder</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>glide<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> resourceClass<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>在<code>RequestManager</code>类中，我们可以看到有很多<code>load</code>方法的重载方法，可以传入不同的图片资源来加载图片资源；在<code>load</code>方法中我们可以看到都是调用了<code>asDrawable()</code>方法返回一个<code>RequestBuilder&lt;Drawable&gt;</code>对象，再调用<code>RequestBuilder&lt;Drawable&gt;</code>对象中的<code>load</code>方法，传入对应的图片资源或地址，进行加载图片；我们来看一下<code>asDrawable()</code> 方法,在第15行，看到<code>asDrawable()</code> 方法中调用了<code>as()</code>方法（第111行）生成了<code>RequestBuilder&lt;Drawable&gt;</code>对象  ，传入了glide对象，当前的   <code>RequestManager</code> 对象，泛型的具体类，和context；  除了<code>asDrawable()</code> 方法，还有三个方法<code>asGif()</code>，<code>asBitmap()</code>和<code>asFile()</code>也调用了<code>as()</code>方法生成了对应类型的<code>RequestBuilder</code>对象。</p>
<p>可以看到，最终是将图片资源传入到了<code>RequestBuilder&lt;TranscodeType&gt;</code>类中的<code>load</code>方法中，接下来我们看一下<code>RequestBuilder&lt;TranscodeType&gt;</code>类中的<code>load</code>方法:</p>
<pre class=" language-Java"><code class="language-Java"> public RequestBuilder<TranscodeType> load(@Nullable Bitmap bitmap) {
    return loadGeneric(bitmap).apply(diskCacheStrategyOf(DiskCacheStrategy.NONE));
  }

  public RequestBuilder<TranscodeType> load(@Nullable Drawable drawable) {
    return loadGeneric(drawable).apply(diskCacheStrategyOf(DiskCacheStrategy.NONE));
  }

  public RequestBuilder<TranscodeType> load(@Nullable String string) {
    return loadGeneric(string);
  }

  public RequestBuilder<TranscodeType> load(@Nullable Uri uri) {
    return loadGeneric(uri);
  }

  public RequestBuilder<TranscodeType> load(@Nullable File file) {
    return loadGeneric(file);
  }

  public RequestBuilder<TranscodeType> load(@RawRes @DrawableRes @Nullable Integer resourceId) {
    return loadGeneric(resourceId).apply(signatureOf(AndroidResourceSignature.obtain(context)));
  }


  public RequestBuilder<TranscodeType> load(@Nullable URL url) {
    return loadGeneric(url);
  }


  public RequestBuilder<TranscodeType> load(@Nullable byte[] model) {
    RequestBuilder<TranscodeType> result = loadGeneric(model);
    if (!result.isDiskCacheStrategySet()) {
      result = result.apply(diskCacheStrategyOf(DiskCacheStrategy.NONE));
    }
    if (!result.isSkipMemoryCacheSet()) {
      result = result.apply(skipMemoryCacheOf(true /*skipMemoryCache*/));
    }
    return result;
  }

public RequestBuilder<TranscodeType> load(@Nullable Object model) {
  return loadGeneric(model);
}

@NonNull
private RequestBuilder<TranscodeType> loadGeneric(@Nullable Object model) {
  this.model = model;
  isModelSet = true;
  return this;
}</code></pre>
<p>可以看到在<code>load</code>方法中都调用了该类中的<code>loadGeneric</code>方法，传入了<code>Object</code>类型的<code>model</code>参数，这个<code>model</code>参数就是我吗传入的图片资源或者图片地址；看到这里，我们是不是有点疑惑，在<code>load</code>方法中调用了<code>loadGeneric</code>方法赋值后，返回<code>RequestBuilder&lt;TranscodeType&gt;</code>对象，Glide的<code>load</code>方法到这里就结束了他的工作。</p>
<h3 id="3-into"><a href="#3-into" class="headerlink" title="3. into"></a>3. into</h3><p>在上面的<code>with</code>和<code>load</code>方法中，我们还没有看到真正的图片加载和显示的代码，所以，可以想到，图片的加载和显示，都是通过<code>into</code>方法来调用执行的，所以，<code>into</code>方法是相对比较难分析的一个方法；接下来我们就一起看一下<code>into</code>方法所承担的重要职责。</p>
<p>执行完<code>load</code>方法，我们获得了<code>RequestBuilder&lt;TranscodeType&gt;</code>对象，所以，into方法，就在<code>RequestBuilder&lt;TranscodeType&gt;</code>类中，我们一起看一张这个类：</p>
<pre class=" language-Java"><code class="language-Java">public class RequestBuilder<TranscodeType> extends BaseRequestOptions<RequestBuilder<TranscodeType>>
    implements Cloneable, ModelTypes<RequestBuilder<TranscodeType>> {

@NonNull
public <Y extends Target<TranscodeType>> Y into(@NonNull Y target) {
  return into(target, /*targetListener=*/ null, Executors.mainThreadExecutor());
}

@NonNull
@Synthetic
<Y extends Target<TranscodeType>> Y into(
    @NonNull Y target,
    @Nullable RequestListener<TranscodeType> targetListener,
    Executor callbackExecutor) {
  return into(target, targetListener, /*options=*/ this, callbackExecutor);
}

private <Y extends Target<TranscodeType>> Y into(
    @NonNull Y target,
    @Nullable RequestListener<TranscodeType> targetListener,
    BaseRequestOptions<?> options,
    Executor callbackExecutor) {
  Preconditions.checkNotNull(target);
  if (!isModelSet) {
    throw new IllegalArgumentException("You must call #load() before calling #into()");
  }

  Request request = buildRequest(target, targetListener, options, callbackExecutor);

  Request previous = target.getRequest();
  if (request.isEquivalentTo(previous)
      && !isSkipMemoryCacheWithCompletePreviousRequest(options, previous)) {
    if (!Preconditions.checkNotNull(previous).isRunning()) {
      previous.begin();
    }
    return target;
  }

  requestManager.clear(target);
  target.setRequest(request);
  requestManager.track(target, request);

  return target;
}


private boolean isSkipMemoryCacheWithCompletePreviousRequest(
    BaseRequestOptions<?> options, Request previous) {
  return !options.isMemoryCacheable() && previous.isComplete();
}

@NonNull
public ViewTarget<ImageView, TranscodeType> into(@NonNull ImageView view) {
  Util.assertMainThread();
  Preconditions.checkNotNull(view);

  BaseRequestOptions<?> requestOptions = this;
  if (!requestOptions.isTransformationSet()
      && requestOptions.isTransformationAllowed()
      && view.getScaleType() != null) {
    switch (view.getScaleType()) {
      case CENTER_CROP:
        requestOptions = requestOptions.clone().optionalCenterCrop();
        break;
      case CENTER_INSIDE:
        requestOptions = requestOptions.clone().optionalCenterInside();
        break;
      case FIT_CENTER:
      case FIT_START:
      case FIT_END:
        requestOptions = requestOptions.clone().optionalFitCenter();
        break;
      case FIT_XY:
        requestOptions = requestOptions.clone().optionalCenterInside();
        break;
      case CENTER:
      case MATRIX:
      default:
        // Do nothing.
    }
  }

  return into(
      glideContext.buildImageViewTarget(view, transcodeClass),
      /*targetListener=*/ null,
      requestOptions,
      Executors.mainThreadExecutor());
}


@Deprecated
public FutureTarget<TranscodeType> into(int width, int height) {
  return submit(width, height);
}


@NonNull
public FutureTarget<TranscodeType> submit() {
  return submit(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL);
}


@NonNull
public FutureTarget<TranscodeType> submit(int width, int height) {
  final RequestFutureTarget<TranscodeType> target = new RequestFutureTarget<>(width, height);
  return into(target, target, Executors.directExecutor());
}


@NonNull
public Target<TranscodeType> preload(int width, int height) {
  final PreloadTarget<TranscodeType> target = PreloadTarget.obtain(requestManager, width, height);
  return into(target);
}


@NonNull
public Target<TranscodeType> preload() {
  return preload(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL);
}
}</code></pre>
<p>可以看到，我们调用的<code>into</code>方法，是第53行参数为ImageView的方法，在这个方法中根据<code>apply</code>方法中传的<code>RequestOptions</code>对象和图片显示类型<code>scaleType</code>来设置<code>RequestOptions</code>对象（当前对象，RequestBuilder 继承自BaseRequestOptions）的Transform类型。并且通过<code>glideContext.buildImageViewTarget(view, transcodeClass)</code>来创建了一个<code>ViewTarget&lt;ImageView, X&gt;</code>对象（<code>BitmapImageViewTarget(view)</code>或<code>DrawableImageViewTarget(view)</code>）,然后将<code>ViewTarget&lt;ImageView, X&gt;</code>对象，<code>RequestOptions</code>对象和<code>Executors.mainThreadExecutor()</code>（主线程的一个线程执行器，内部有一个主线程的handler对象用了执行runnable对象）传入到第18行的into方法，接下来我们看一下，在这个<code>into</code>方法中做了什么操作。</p>
<p>在第28行可以看到通过<code>buildRequest(target, targetListener, options, callbackExecutor)</code>方法得到了一个<code>Request</code>对象 <code>request</code>,稍后来看这个方法。继续往下看，第30行，通过传入的<code>target.getRequest()</code>方法也获得了一个<code>Request</code>对象 <code>previous</code>然后判断这两个<code>Request</code>对象是否是同一个请求（判断请求的参数和资源地址），如果是同一个请求，并且未跳过内存缓存完成请求，则<code>target</code>的<code>Request</code>对象开始请求<code>previous.begin();</code></p>
<p>如果两个<code>Request</code>对象不满足上面的条件，则将该<code>request</code>对象设置给<code>target</code>的<code>Request</code>对象，并且将该<code>request</code>对象通过<code>RequestManager</code>对象的<code>track(target, request)</code>方法，将该<code>request</code>对象添加到请求追踪器<code>RequestTracker</code>对象中进行请求（<code>runRequest(Request request)</code>）；粘一下代码</p>
<blockquote>
<p><code>RequestManager</code>对象的<code>track(target, request)</code>方法</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Target<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> target<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> Request request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  targetTracker<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  requestTracker<span class="token punctuation">.</span><span class="token function">runRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p><code>RequestTracker</code>对象中的<code>runRequest(Request request)</code>方法</p>
</blockquote>
<pre class=" language-Java"><code class="language-Java">public void runRequest(@NonNull Request request) {
  requests.add(request);
  if (!isPaused) {
    request.begin();
  } else {
    request.clear();
    if (Log.isLoggable(TAG, Log.VERBOSE)) {
      Log.v(TAG, "Paused, delaying request");
    }
    pendingRequests.add(request);
  }
}</code></pre>
<p>可以看到在<code>runRequest(Request request)</code>方法中，先将该请求添加到请求的集合中，并且判断当前是否处于暂停加载的状态，如果不处于暂停加载状态，则执行请求对象的<code>begin()</code>方法开始请求图片，如果处于暂停加载状态，则清除加载列表，并将该请求加入等待请求的队列，待下次重新开始请求时进行请求。</p>
<p>接下来我们来了解一下<code>buildRequest</code>方法的内容</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> Request <span class="token function">buildRequest</span><span class="token punctuation">(</span>
    Target<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> target<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Nullable</span> RequestListener<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> targetListener<span class="token punctuation">,</span>
    BaseRequestOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> requestOptions<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">buildRequestRecursive</span><span class="token punctuation">(</span>
      <span class="token comment" spellcheck="true">/*requestLock=*/</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      target<span class="token punctuation">,</span>
      targetListener<span class="token punctuation">,</span>
      <span class="token comment" spellcheck="true">/*parentCoordinator=*/</span> null<span class="token punctuation">,</span>
      transitionOptions<span class="token punctuation">,</span>
      requestOptions<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      requestOptions<span class="token punctuation">,</span>
      callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> Request <span class="token function">buildRequestRecursive</span><span class="token punctuation">(</span>
    Object requestLock<span class="token punctuation">,</span>
    Target<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> target<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Nullable</span> RequestListener<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> targetListener<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Nullable</span> RequestCoordinator parentCoordinator<span class="token punctuation">,</span>
    TransitionOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> TranscodeType<span class="token operator">></span> transitionOptions<span class="token punctuation">,</span>
    Priority priority<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideWidth<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideHeight<span class="token punctuation">,</span>
    BaseRequestOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> requestOptions<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// Build the ErrorRequestCoordinator first if necessary so we can update parentCoordinator.</span>
  ErrorRequestCoordinator errorRequestCoordinator <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errorBuilder <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errorRequestCoordinator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorRequestCoordinator</span><span class="token punctuation">(</span>requestLock<span class="token punctuation">,</span> parentCoordinator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    parentCoordinator <span class="token operator">=</span> errorRequestCoordinator<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Request mainRequest <span class="token operator">=</span>
      <span class="token function">buildThumbnailRequestRecursive</span><span class="token punctuation">(</span>
          requestLock<span class="token punctuation">,</span>
          target<span class="token punctuation">,</span>
          targetListener<span class="token punctuation">,</span>
          parentCoordinator<span class="token punctuation">,</span>
          transitionOptions<span class="token punctuation">,</span>
          priority<span class="token punctuation">,</span>
          overrideWidth<span class="token punctuation">,</span>
          overrideHeight<span class="token punctuation">,</span>
          requestOptions<span class="token punctuation">,</span>
          callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>errorRequestCoordinator <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mainRequest<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">int</span> errorOverrideWidth <span class="token operator">=</span> errorBuilder<span class="token punctuation">.</span><span class="token function">getOverrideWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> errorOverrideHeight <span class="token operator">=</span> errorBuilder<span class="token punctuation">.</span><span class="token function">getOverrideHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Util<span class="token punctuation">.</span><span class="token function">isValidDimensions</span><span class="token punctuation">(</span>overrideWidth<span class="token punctuation">,</span> overrideHeight<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>errorBuilder<span class="token punctuation">.</span><span class="token function">isValidOverride</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    errorOverrideWidth <span class="token operator">=</span> requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorOverrideHeight <span class="token operator">=</span> requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Request errorRequest <span class="token operator">=</span>
      errorBuilder<span class="token punctuation">.</span><span class="token function">buildRequestRecursive</span><span class="token punctuation">(</span>
          requestLock<span class="token punctuation">,</span>
          target<span class="token punctuation">,</span>
          targetListener<span class="token punctuation">,</span>
          errorRequestCoordinator<span class="token punctuation">,</span>
          errorBuilder<span class="token punctuation">.</span>transitionOptions<span class="token punctuation">,</span>
          errorBuilder<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          errorOverrideWidth<span class="token punctuation">,</span>
          errorOverrideHeight<span class="token punctuation">,</span>
          errorBuilder<span class="token punctuation">,</span>
          callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  errorRequestCoordinator<span class="token punctuation">.</span><span class="token function">setRequests</span><span class="token punctuation">(</span>mainRequest<span class="token punctuation">,</span> errorRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> errorRequestCoordinator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> Request <span class="token function">buildThumbnailRequestRecursive</span><span class="token punctuation">(</span>
    Object requestLock<span class="token punctuation">,</span>
    Target<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> target<span class="token punctuation">,</span>
    RequestListener<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> targetListener<span class="token punctuation">,</span>
    <span class="token annotation punctuation">@Nullable</span> RequestCoordinator parentCoordinator<span class="token punctuation">,</span>
    TransitionOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> TranscodeType<span class="token operator">></span> transitionOptions<span class="token punctuation">,</span>
    Priority priority<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideWidth<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideHeight<span class="token punctuation">,</span>
    BaseRequestOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> requestOptions<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>thumbnailBuilder <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Recursive case: contains a potentially recursive thumbnail request builder.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isThumbnailBuilt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
          <span class="token string">"You cannot use a request as both the main request and a "</span>
              <span class="token operator">+</span> <span class="token string">"thumbnail, consider using clone() on the request(s) passed to thumbnail()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    TransitionOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> TranscodeType<span class="token operator">></span> thumbTransitionOptions <span class="token operator">=</span>
        thumbnailBuilder<span class="token punctuation">.</span>transitionOptions<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Apply our transition by default to thumbnail requests but avoid overriding custom options</span>
    <span class="token comment" spellcheck="true">// that may have been applied on the thumbnail request explicitly.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thumbnailBuilder<span class="token punctuation">.</span>isDefaultTransitionOptionsSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      thumbTransitionOptions <span class="token operator">=</span> transitionOptions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Priority thumbPriority <span class="token operator">=</span>
        thumbnailBuilder<span class="token punctuation">.</span><span class="token function">isPrioritySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> thumbnailBuilder<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token function">getThumbnailPriority</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> thumbOverrideWidth <span class="token operator">=</span> thumbnailBuilder<span class="token punctuation">.</span><span class="token function">getOverrideWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> thumbOverrideHeight <span class="token operator">=</span> thumbnailBuilder<span class="token punctuation">.</span><span class="token function">getOverrideHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Util<span class="token punctuation">.</span><span class="token function">isValidDimensions</span><span class="token punctuation">(</span>overrideWidth<span class="token punctuation">,</span> overrideHeight<span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>thumbnailBuilder<span class="token punctuation">.</span><span class="token function">isValidOverride</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      thumbOverrideWidth <span class="token operator">=</span> requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      thumbOverrideHeight <span class="token operator">=</span> requestOptions<span class="token punctuation">.</span><span class="token function">getOverrideHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    ThumbnailRequestCoordinator coordinator <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">ThumbnailRequestCoordinator</span><span class="token punctuation">(</span>requestLock<span class="token punctuation">,</span> parentCoordinator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Request fullRequest <span class="token operator">=</span>
        <span class="token function">obtainRequest</span><span class="token punctuation">(</span>
            requestLock<span class="token punctuation">,</span>
            target<span class="token punctuation">,</span>
            targetListener<span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">,</span>
            coordinator<span class="token punctuation">,</span>
            transitionOptions<span class="token punctuation">,</span>
            priority<span class="token punctuation">,</span>
            overrideWidth<span class="token punctuation">,</span>
            overrideHeight<span class="token punctuation">,</span>
            callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    isThumbnailBuilt <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Recursively generate thumbnail requests.</span>
    Request thumbRequest <span class="token operator">=</span>
        thumbnailBuilder<span class="token punctuation">.</span><span class="token function">buildRequestRecursive</span><span class="token punctuation">(</span>
            requestLock<span class="token punctuation">,</span>
            target<span class="token punctuation">,</span>
            targetListener<span class="token punctuation">,</span>
            coordinator<span class="token punctuation">,</span>
            thumbTransitionOptions<span class="token punctuation">,</span>
            thumbPriority<span class="token punctuation">,</span>
            thumbOverrideWidth<span class="token punctuation">,</span>
            thumbOverrideHeight<span class="token punctuation">,</span>
            thumbnailBuilder<span class="token punctuation">,</span>
            callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    isThumbnailBuilt <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    coordinator<span class="token punctuation">.</span><span class="token function">setRequests</span><span class="token punctuation">(</span>fullRequest<span class="token punctuation">,</span> thumbRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coordinator<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>thumbSizeMultiplier <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Base case: thumbnail multiplier generates a thumbnail request, but cannot recurse.</span>
    ThumbnailRequestCoordinator coordinator <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">ThumbnailRequestCoordinator</span><span class="token punctuation">(</span>requestLock<span class="token punctuation">,</span> parentCoordinator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Request fullRequest <span class="token operator">=</span>
        <span class="token function">obtainRequest</span><span class="token punctuation">(</span>
            requestLock<span class="token punctuation">,</span>
            target<span class="token punctuation">,</span>
            targetListener<span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">,</span>
            coordinator<span class="token punctuation">,</span>
            transitionOptions<span class="token punctuation">,</span>
            priority<span class="token punctuation">,</span>
            overrideWidth<span class="token punctuation">,</span>
            overrideHeight<span class="token punctuation">,</span>
            callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    BaseRequestOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> thumbnailOptions <span class="token operator">=</span>
        requestOptions<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sizeMultiplier</span><span class="token punctuation">(</span>thumbSizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Request thumbnailRequest <span class="token operator">=</span>
        <span class="token function">obtainRequest</span><span class="token punctuation">(</span>
            requestLock<span class="token punctuation">,</span>
            target<span class="token punctuation">,</span>
            targetListener<span class="token punctuation">,</span>
            thumbnailOptions<span class="token punctuation">,</span>
            coordinator<span class="token punctuation">,</span>
            transitionOptions<span class="token punctuation">,</span>
            <span class="token function">getThumbnailPriority</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">,</span>
            overrideWidth<span class="token punctuation">,</span>
            overrideHeight<span class="token punctuation">,</span>
            callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    coordinator<span class="token punctuation">.</span><span class="token function">setRequests</span><span class="token punctuation">(</span>fullRequest<span class="token punctuation">,</span> thumbnailRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coordinator<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Base case: no thumbnail.</span>
    <span class="token keyword">return</span> <span class="token function">obtainRequest</span><span class="token punctuation">(</span>
        requestLock<span class="token punctuation">,</span>
        target<span class="token punctuation">,</span>
        targetListener<span class="token punctuation">,</span>
        requestOptions<span class="token punctuation">,</span>
        parentCoordinator<span class="token punctuation">,</span>
        transitionOptions<span class="token punctuation">,</span>
        priority<span class="token punctuation">,</span>
        overrideWidth<span class="token punctuation">,</span>
        overrideHeight<span class="token punctuation">,</span>
        callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> Request <span class="token function">obtainRequest</span><span class="token punctuation">(</span>
    Object requestLock<span class="token punctuation">,</span>
    Target<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> target<span class="token punctuation">,</span>
    RequestListener<span class="token operator">&lt;</span>TranscodeType<span class="token operator">></span> targetListener<span class="token punctuation">,</span>
    BaseRequestOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> requestOptions<span class="token punctuation">,</span>
    RequestCoordinator requestCoordinator<span class="token punctuation">,</span>
    TransitionOptions<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> TranscodeType<span class="token operator">></span> transitionOptions<span class="token punctuation">,</span>
    Priority priority<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideWidth<span class="token punctuation">,</span>
    <span class="token keyword">int</span> overrideHeight<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> SingleRequest<span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>
      context<span class="token punctuation">,</span>
      glideContext<span class="token punctuation">,</span>
      requestLock<span class="token punctuation">,</span>
      model<span class="token punctuation">,</span>
      transcodeClass<span class="token punctuation">,</span>
      requestOptions<span class="token punctuation">,</span>
      overrideWidth<span class="token punctuation">,</span>
      overrideHeight<span class="token punctuation">,</span>
      priority<span class="token punctuation">,</span>
      target<span class="token punctuation">,</span>
      targetListener<span class="token punctuation">,</span>
      requestListeners<span class="token punctuation">,</span>
      requestCoordinator<span class="token punctuation">,</span>
      glideContext<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      transitionOptions<span class="token punctuation">.</span><span class="token function">getTransitionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>可以看到在第1行<code>buildRequest()</code>方法中调用了<code>buildRequestRecursive</code>方法（第19行），在该方法中，根据在<code>RequestBuilder</code>类对象中设置的<code>errorBuilder</code>（类型为RequestBuilder<TranscodeType>）来创建不同的<code>Request</code>对象，<code>buildThumbnailRequestRecursive</code>方法中判断是否存在缩略图来创建不同的<code>Request</code>对象（创建一个拥有请求原图的<code>Request</code>对象和请求缩略图的<code>Request</code>对象的<code>ThumbnailRequestCoordinator</code>对象，或者只有单个请求的<code>SingleRequest</code>对象），最终都是执行了<code>Request</code>对象的<code>begin()</code>方法取请求图片资源；在上面的方法中可以看到，多次执行之后，最终大部分都<code>Request</code>对象中包含了<code>SingleRequest</code>对象，其中的<code>begin()</code>方法也是调用了<code>SingleRequest</code>对象中的<code>begin()</code>方法，接下来我们来看一下<code>SingleRequest</code>对象中的<code>begin()</code>方法；分析到现在为止，我们还没有看到请求图片资源的代码，所以猜想<code>SingleRequest</code>对象中的<code>begin()</code>方法接下来应该就是调起网络请求的方法。</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>requestLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertNotCallingCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    startTime <span class="token operator">=</span> LogTime<span class="token punctuation">.</span><span class="token function">getLogTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>model <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Util<span class="token punctuation">.</span><span class="token function">isValidDimensions</span><span class="token punctuation">(</span>overrideWidth<span class="token punctuation">,</span> overrideHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        width <span class="token operator">=</span> overrideWidth<span class="token punctuation">;</span>
        height <span class="token operator">=</span> overrideHeight<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">int</span> logLevel <span class="token operator">=</span> <span class="token function">getFallbackDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> null <span class="token operator">?</span> Log<span class="token punctuation">.</span>WARN <span class="token operator">:</span> Log<span class="token punctuation">.</span>DEBUG<span class="token punctuation">;</span>
      <span class="token function">onLoadFailed</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GlideException</span><span class="token punctuation">(</span><span class="token string">"Received null model"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> Status<span class="token punctuation">.</span>RUNNING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Cannot restart a running request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> Status<span class="token punctuation">.</span>COMPLETE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onResourceReady</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> DataSource<span class="token punctuation">.</span>MEMORY_CACHE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    status <span class="token operator">=</span> Status<span class="token punctuation">.</span>WAITING_FOR_SIZE<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Util<span class="token punctuation">.</span><span class="token function">isValidDimensions</span><span class="token punctuation">(</span>overrideWidth<span class="token punctuation">,</span> overrideHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">onSizeReady</span><span class="token punctuation">(</span>overrideWidth<span class="token punctuation">,</span> overrideHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status <span class="token operator">==</span> Status<span class="token punctuation">.</span>RUNNING <span class="token operator">||</span> status <span class="token operator">==</span> Status<span class="token punctuation">.</span>WAITING_FOR_SIZE<span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token function">canNotifyStatusChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">.</span><span class="token function">onLoadStarted</span><span class="token punctuation">(</span><span class="token function">getPlaceholderDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_VERBOSE_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">logV</span><span class="token punctuation">(</span><span class="token string">"finished run method in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>GlideException e<span class="token punctuation">,</span> <span class="token keyword">int</span> maxLogLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>requestLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">setOrigin</span><span class="token punctuation">(</span>requestOrigin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> logLevel <span class="token operator">=</span> glideContext<span class="token punctuation">.</span><span class="token function">getLogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>logLevel <span class="token operator">&lt;=</span> maxLogLevel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>
            GLIDE_TAG<span class="token punctuation">,</span> <span class="token string">"Load failed for "</span> <span class="token operator">+</span> model <span class="token operator">+</span> <span class="token string">" with size ["</span> <span class="token operator">+</span> width <span class="token operator">+</span> <span class="token string">"x"</span> <span class="token operator">+</span> height <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logLevel <span class="token operator">&lt;=</span> Log<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">logRootCauses</span><span class="token punctuation">(</span>GLIDE_TAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      loadStatus <span class="token operator">=</span> null<span class="token punctuation">;</span>
      status <span class="token operator">=</span> Status<span class="token punctuation">.</span>FAILED<span class="token punctuation">;</span>

      isCallingCallbacks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO: what if this is a thumbnail request?</span>
        <span class="token keyword">boolean</span> anyListenerHandledUpdatingTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestListeners <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span>RequestListener<span class="token operator">&lt;</span>R<span class="token operator">></span> listener <span class="token operator">:</span> requestListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            anyListenerHandledUpdatingTarget <span class="token operator">|=</span>
                listener<span class="token punctuation">.</span><span class="token function">onLoadFailed</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> model<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token function">isFirstReadyResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        anyListenerHandledUpdatingTarget <span class="token operator">|=</span>
            targetListener <span class="token operator">!=</span> null
                <span class="token operator">&amp;&amp;</span> targetListener<span class="token punctuation">.</span><span class="token function">onLoadFailed</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> model<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token function">isFirstReadyResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>anyListenerHandledUpdatingTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setErrorPlaceholder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        isCallingCallbacks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">notifyLoadFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setErrorPlaceholder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canNotifyStatusChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Drawable error <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>model <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token function">getFallbackDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// Either the model isn't null, or there was no fallback drawable set.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token function">getErrorDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// The model isn't null, no fallback drawable was set or no error drawable was set.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token function">getPlaceholderDrawable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    target<span class="token punctuation">.</span><span class="token function">onLoadFailed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>可以看到在这个方法里，<code>stateVerifier.throwIfRecycled()</code>,中判断了生命周期，如果没销毁，则抛出异常。</p>
<p>然后判断了<code>model == null</code>，这里的model就是我们之前传入的图片资源（图片地址），为空的时候，则不需要加载，直接执行<code>onLoadFailed</code>方法，在<code>onLoadFailed</code>方法中则是判断加载的监听器是否处理了<code>onLoadFailed</code>事件，如果没有处理，则设置加载错误的占位图片（第73行），最终则执行target的<code>target.onLoadFailed(error);</code>回调方法将错误占位图显示出来</p>
<p>当model不为空，继续向下执行，判断了当前状态是否在运行中(第17行)，如果是，抛出异常，如果不是，继续判读状态是否已完成，如果已完成，则执行<code>onResourceReady</code>回调方法（第22行），这个方法我们稍后在看，如果状态不是已完成状态，则继续向下执行，判断宽度和高度是否有效（&gt;0或者为自适应），如果有效执行<code>onSizeReady</code>方法，如果无效，则执行<code>target.getSize(this);</code>方法，重新获取宽度和高度，<code>target.getSize(this)</code>是ViewTarget中的方法，在该方法中获取了当前target的宽度和高度，获取有效宽度和高度之后，回调继续执行<code>onSizeReady</code>方法。这里的cb就是在<code>target.getSize(this);</code>方法中传递过来的this，也就是<code>SingleRequest</code>类对象</p>
<blockquote>
<p><code>target.getSize(this)</code> 方法</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> SizeReadyCallback cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> currentWidth <span class="token operator">=</span> <span class="token function">getTargetWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> currentHeight <span class="token operator">=</span> <span class="token function">getTargetHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isViewStateAndSizeValid</span><span class="token punctuation">(</span>currentWidth<span class="token punctuation">,</span> currentHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cb<span class="token punctuation">.</span><span class="token function">onSizeReady</span><span class="token punctuation">(</span>currentWidth<span class="token punctuation">,</span> currentHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// We want to notify callbacks in the order they were added and we only expect one or two</span>
  <span class="token comment" spellcheck="true">// callbacks to be added a time, so a List is a reasonable choice.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cbs<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>layoutListener <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ViewTreeObserver observer <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getViewTreeObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    layoutListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SizeDeterminerLayoutListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">addOnPreDrawListener</span><span class="token punctuation">(</span>layoutListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>可以看到<code>target.getSize(this)</code>最终还是执行了<code>onSizeReady</code>方法，接下来我们看一下在<code>onSizeReady</code>方法中做了什么</p>
<blockquote>
<p><code>SingleRequest</code>类对象中的<code>onSizeReady</code>方法</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSizeReady</span><span class="token punctuation">(</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>requestLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_VERBOSE_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">logV</span><span class="token punctuation">(</span><span class="token string">"Got onSizeReady in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> Status<span class="token punctuation">.</span>WAITING_FOR_SIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    status <span class="token operator">=</span> Status<span class="token punctuation">.</span>RUNNING<span class="token punctuation">;</span>

    <span class="token keyword">float</span> sizeMultiplier <span class="token operator">=</span> requestOptions<span class="token punctuation">.</span><span class="token function">getSizeMultiplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token function">maybeApplySizeMultiplier</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">maybeApplySizeMultiplier</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> sizeMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_VERBOSE_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">logV</span><span class="token punctuation">(</span><span class="token string">"finished setup for calling load in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    loadStatus <span class="token operator">=</span>
        engine<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
            glideContext<span class="token punctuation">,</span>
            model<span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getResourceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            transcodeClass<span class="token punctuation">,</span>
            priority<span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getDiskCacheStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getTransformations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">isTransformationRequired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">isScaleOnlyOrNoTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">isMemoryCacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getUseUnlimitedSourceGeneratorsPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getUseAnimationPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requestOptions<span class="token punctuation">.</span><span class="token function">getOnlyRetrieveFromCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">,</span>
            callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// This is a hack that's only useful for testing right now where loads complete synchronously</span>
    <span class="token comment" spellcheck="true">// even though under any executor running on any thread but the main thread, the load would</span>
    <span class="token comment" spellcheck="true">// have completed asynchronously.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">!=</span> Status<span class="token punctuation">.</span>RUNNING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      loadStatus <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_VERBOSE_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">logV</span><span class="token punctuation">(</span><span class="token string">"finished onSizeReady in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>可以看到，在第20行，调用了<code>engine.load</code>方法，传入了很多的参数，大部分都是根图片相关的倒数第二款参数this，可前面一样，也是<code>ResourceCallback</code>类型的，用于回调；接下来进入到<code>engine.load</code>方法看一下</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token operator">&lt;</span>R<span class="token operator">></span> LoadStatus <span class="token function">load</span><span class="token punctuation">(</span>
    GlideContext glideContext<span class="token punctuation">,</span>
    Object model<span class="token punctuation">,</span>
    Key signature<span class="token punctuation">,</span>
    <span class="token keyword">int</span> width<span class="token punctuation">,</span>
    <span class="token keyword">int</span> height<span class="token punctuation">,</span>
    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> resourceClass<span class="token punctuation">,</span>
    Class<span class="token operator">&lt;</span>R<span class="token operator">></span> transcodeClass<span class="token punctuation">,</span>
    Priority priority<span class="token punctuation">,</span>
    DiskCacheStrategy diskCacheStrategy<span class="token punctuation">,</span>
    Map<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">,</span> Transformation<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">>></span> transformations<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isTransformationRequired<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isScaleOnlyOrNoTransform<span class="token punctuation">,</span>
    Options options<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isMemoryCacheable<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> useUnlimitedSourceExecutorPool<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> useAnimationPool<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> onlyRetrieveFromCache<span class="token punctuation">,</span>
    ResourceCallback cb<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> startTime <span class="token operator">=</span> VERBOSE_IS_LOGGABLE <span class="token operator">?</span> LogTime<span class="token punctuation">.</span><span class="token function">getLogTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

  EngineKey key <span class="token operator">=</span>
      keyFactory<span class="token punctuation">.</span><span class="token function">buildKey</span><span class="token punctuation">(</span>
          model<span class="token punctuation">,</span>
          signature<span class="token punctuation">,</span>
          width<span class="token punctuation">,</span>
          height<span class="token punctuation">,</span>
          transformations<span class="token punctuation">,</span>
          resourceClass<span class="token punctuation">,</span>
          transcodeClass<span class="token punctuation">,</span>
          options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> memoryResource<span class="token punctuation">;</span>
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    memoryResource <span class="token operator">=</span> <span class="token function">loadFromMemory</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> isMemoryCacheable<span class="token punctuation">,</span> startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>memoryResource <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">waitForExistingOrStartNewJob</span><span class="token punctuation">(</span>
          glideContext<span class="token punctuation">,</span>
          model<span class="token punctuation">,</span>
          signature<span class="token punctuation">,</span>
          width<span class="token punctuation">,</span>
          height<span class="token punctuation">,</span>
          resourceClass<span class="token punctuation">,</span>
          transcodeClass<span class="token punctuation">,</span>
          priority<span class="token punctuation">,</span>
          diskCacheStrategy<span class="token punctuation">,</span>
          transformations<span class="token punctuation">,</span>
          isTransformationRequired<span class="token punctuation">,</span>
          isScaleOnlyOrNoTransform<span class="token punctuation">,</span>
          options<span class="token punctuation">,</span>
          isMemoryCacheable<span class="token punctuation">,</span>
          useUnlimitedSourceExecutorPool<span class="token punctuation">,</span>
          useAnimationPool<span class="token punctuation">,</span>
          onlyRetrieveFromCache<span class="token punctuation">,</span>
          cb<span class="token punctuation">,</span>
          callbackExecutor<span class="token punctuation">,</span>
          key<span class="token punctuation">,</span>
          startTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// Avoid calling back while holding the engine lock, doing so makes it easier for callers to</span>
  <span class="token comment" spellcheck="true">// deadlock.</span>
  cb<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>memoryResource<span class="token punctuation">,</span> DataSource<span class="token punctuation">.</span>MEMORY_CACHE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> null<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">loadFromMemory</span><span class="token punctuation">(</span>
      EngineKey key<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isMemoryCacheable<span class="token punctuation">,</span> <span class="token keyword">long</span> startTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMemoryCacheable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> active <span class="token operator">=</span> <span class="token function">loadFromActiveResources</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>active <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">"Loaded resource from active resources"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> active<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cached <span class="token operator">=</span> <span class="token function">loadFromCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">"Loaded resource from cache"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span>String log<span class="token punctuation">,</span> <span class="token keyword">long</span> startTime<span class="token punctuation">,</span> Key key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Log<span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> log <span class="token operator">+</span> <span class="token string">" in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms, key: "</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">private</span> EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">loadFromActiveResources</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> active <span class="token operator">=</span> activeResources<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>active <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      active<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> active<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">loadFromCache</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cached <span class="token operator">=</span> <span class="token function">getEngineResourceFromCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cached<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      activeResources<span class="token punctuation">.</span><span class="token function">activate</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> cached<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

 <span class="token keyword">private</span> EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">getEngineResourceFromCache</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Resource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> cached <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token keyword">instanceof</span> <span class="token class-name">EngineResource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Save an object allocation if we've cached an EngineResource (the typical case).</span>
      result <span class="token operator">=</span> <span class="token punctuation">(</span>EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">)</span> cached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span>
          <span class="token keyword">new</span> <span class="token class-name">EngineResource</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>
              cached<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/*isMemoryCacheable=*/</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/*isRecyclable=*/</span> <span class="token boolean">true</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/*listener=*/</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>在<code>engine.load</code>方法中，可以看到，第23行，根据传入的请求地址，宽度和高度，签名等其他请求参数，生成了一个<code>EngineKey</code>对象key，这个对象就是用了标识每一个请求，不难想到，如果参数全部相同，则生成的key对象也相同；在第36行中，看到执行了<code>loadFromMemory</code>方法，在该方法中先是通过<code>loadFromActiveResources</code>方法，从内存中查找是否有对象key 的缓存资源，如果有返回；如果没有，则通过<code>loadFromCache</code>方法从缓存中查找是否有对象key的缓存资源，在<code>getEngineResourceFromCache</code>方法中，通过<code>cache.remove(key)</code>方法来获取到一个缓存对象，这里的<code>cahce</code>对象就是<code>LruResourceCache</code>的类对象，是通过<code>LruResourceCache</code>的类对象来缓存资源。</p>
<p>看完了获取缓存的方法之后，我们回过头来继续看加载的方法，第38行，当获取的缓存为空时，返回了<code>waitForExistingOrStartNewJob</code>方法的结果，我们来看一下<code>waitForExistingOrStartNewJob</code>方法</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token operator">&lt;</span>R<span class="token operator">></span> LoadStatus <span class="token function">waitForExistingOrStartNewJob</span><span class="token punctuation">(</span>
    GlideContext glideContext<span class="token punctuation">,</span>
    Object model<span class="token punctuation">,</span>
    Key signature<span class="token punctuation">,</span>
    <span class="token keyword">int</span> width<span class="token punctuation">,</span>
    <span class="token keyword">int</span> height<span class="token punctuation">,</span>
    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> resourceClass<span class="token punctuation">,</span>
    Class<span class="token operator">&lt;</span>R<span class="token operator">></span> transcodeClass<span class="token punctuation">,</span>
    Priority priority<span class="token punctuation">,</span>
    DiskCacheStrategy diskCacheStrategy<span class="token punctuation">,</span>
    Map<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span><span class="token punctuation">,</span> Transformation<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">>></span> transformations<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isTransformationRequired<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isScaleOnlyOrNoTransform<span class="token punctuation">,</span>
    Options options<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> isMemoryCacheable<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> useUnlimitedSourceExecutorPool<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> useAnimationPool<span class="token punctuation">,</span>
    <span class="token keyword">boolean</span> onlyRetrieveFromCache<span class="token punctuation">,</span>
    ResourceCallback cb<span class="token punctuation">,</span>
    Executor callbackExecutor<span class="token punctuation">,</span>
    EngineKey key<span class="token punctuation">,</span>
    <span class="token keyword">long</span> startTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  EngineJob<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> current <span class="token operator">=</span> jobs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> onlyRetrieveFromCache<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    current<span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">"Added to existing load"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoadStatus</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  EngineJob<span class="token operator">&lt;</span>R<span class="token operator">></span> engineJob <span class="token operator">=</span>
      engineJobFactory<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
          key<span class="token punctuation">,</span>
          isMemoryCacheable<span class="token punctuation">,</span>
          useUnlimitedSourceExecutorPool<span class="token punctuation">,</span>
          useAnimationPool<span class="token punctuation">,</span>
          onlyRetrieveFromCache<span class="token punctuation">)</span><span class="token punctuation">;</span>

  DecodeJob<span class="token operator">&lt;</span>R<span class="token operator">></span> decodeJob <span class="token operator">=</span>
      decodeJobFactory<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
          glideContext<span class="token punctuation">,</span>
          model<span class="token punctuation">,</span>
          key<span class="token punctuation">,</span>
          signature<span class="token punctuation">,</span>
          width<span class="token punctuation">,</span>
          height<span class="token punctuation">,</span>
          resourceClass<span class="token punctuation">,</span>
          transcodeClass<span class="token punctuation">,</span>
          priority<span class="token punctuation">,</span>
          diskCacheStrategy<span class="token punctuation">,</span>
          transformations<span class="token punctuation">,</span>
          isTransformationRequired<span class="token punctuation">,</span>
          isScaleOnlyOrNoTransform<span class="token punctuation">,</span>
          onlyRetrieveFromCache<span class="token punctuation">,</span>
          options<span class="token punctuation">,</span>
          engineJob<span class="token punctuation">)</span><span class="token punctuation">;</span>

  jobs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> engineJob<span class="token punctuation">)</span><span class="token punctuation">;</span>

  engineJob<span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  engineJob<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>decodeJob<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">"Started new load"</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LoadStatus</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> engineJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>前面看了<code>load</code>方法中，已经从缓存中取了资源，没有取到，在执行该方法，可想而知，真正的网络请求，则是在该方法中执行的；看到在第24行中，通过jobs对象获取了<code>EngineJob</code>对象current，如果有取到，则说明有正在请求的对象，将回调加入到当前对象中，返回当前请求状态；如果没有取到，则创建一个<code>engineJob</code>对象和一个<code>decodeJob</code>对象；然后为该请求对象添加回调接口对象，并且传入<code>decodeJob</code>进行启动加载（第63行）；看下<code>engineJob.start</code>方法.</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span>DecodeJob<span class="token operator">&lt;</span>R<span class="token operator">></span> decodeJob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>decodeJob <span class="token operator">=</span> decodeJob<span class="token punctuation">;</span>
  GlideExecutor executor <span class="token operator">=</span>
      decodeJob<span class="token punctuation">.</span><span class="token function">willDecodeFromCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> diskCacheExecutor <span class="token operator">:</span> <span class="token function">getActiveSourceExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>decodeJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>在该方法中根据<code>decodeJob.willDecodeFromCache()</code>获取到了一个<code>GlideExecutor</code>对象，该对象实现了<code>ExecutorService</code>接口类，是一个用了处理请求任务的线程池，在看一下<code>executor.execute(decodeJob)</code>方法需要传入一个<code>Runnable</code>对象，然后我吗回去看<code>DecodeJob</code>类是实现了<code>Runnable</code>接口，所以可以想到上面的<code>engineJob</code>对象是一个处理线程的线程池对象，真正的请求工作是在<code>decodeJob</code>对象的<code>run</code>方法中执行。</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  GlideTrace<span class="token punctuation">.</span><span class="token function">beginSectionFormat</span><span class="token punctuation">(</span><span class="token string">"DecodeJob#run(model=%s)"</span><span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  DataFetcher<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> localFetcher <span class="token operator">=</span> currentFetcher<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isCancelled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">notifyFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">runWrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CallbackException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Log<span class="token punctuation">.</span><span class="token function">isLoggable</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> Log<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
          TAG<span class="token punctuation">,</span>
          <span class="token string">"DecodeJob threw unexpectedly"</span> <span class="token operator">+</span> <span class="token string">", isCancelled: "</span> <span class="token operator">+</span> isCancelled <span class="token operator">+</span> <span class="token string">", stage: "</span> <span class="token operator">+</span> stage<span class="token punctuation">,</span>
          t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stage <span class="token operator">!=</span> Stage<span class="token punctuation">.</span>ENCODE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      throwables<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">notifyFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCancelled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> t<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>localFetcher <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      localFetcher<span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    GlideTrace<span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">runWrapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>runReason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> INITIALIZE<span class="token operator">:</span>
      stage <span class="token operator">=</span> <span class="token function">getNextStage</span><span class="token punctuation">(</span>Stage<span class="token punctuation">.</span>INITIALIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      currentGenerator <span class="token operator">=</span> <span class="token function">getNextGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">runGenerators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> SWITCH_TO_SOURCE_SERVICE<span class="token operator">:</span>
      <span class="token function">runGenerators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> DECODE_DATA<span class="token operator">:</span>
      <span class="token function">decodeFromRetrievedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Unrecognized run reason: "</span> <span class="token operator">+</span> runReason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> DataFetcherGenerator <span class="token function">getNextGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>stage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> RESOURCE_CACHE<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResourceCacheGenerator</span><span class="token punctuation">(</span>decodeHelper<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> DATA_CACHE<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataCacheGenerator</span><span class="token punctuation">(</span>decodeHelper<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> SOURCE<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SourceGenerator</span><span class="token punctuation">(</span>decodeHelper<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FINISHED<span class="token operator">:</span>
      <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Unrecognized stage: "</span> <span class="token operator">+</span> stage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">runGenerators</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentThread <span class="token operator">=</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  startFetchTime <span class="token operator">=</span> LogTime<span class="token punctuation">.</span><span class="token function">getLogTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> isStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCancelled
      <span class="token operator">&amp;&amp;</span> currentGenerator <span class="token operator">!=</span> null
      <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>isStarted <span class="token operator">=</span> currentGenerator<span class="token punctuation">.</span><span class="token function">startNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    stage <span class="token operator">=</span> <span class="token function">getNextStage</span><span class="token punctuation">(</span>stage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentGenerator <span class="token operator">=</span> <span class="token function">getNextGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>stage <span class="token operator">==</span> Stage<span class="token punctuation">.</span>SOURCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reschedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>stage <span class="token operator">==</span> Stage<span class="token punctuation">.</span>FINISHED <span class="token operator">||</span> isCancelled<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isStarted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">notifyFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>可以看到，在<code>run</code>方法中，除了一些判断和释放资源的操作，主要是执行了<code>runWrapped()</code>方法；在<code>runWrapped()</code>方法中，根据不同的<code>runReason</code>,执行了<code>getNextGenerator()</code>和<code>runGenerators()</code>方法，<code>getNextGenerator()</code>方法根据不同的stage生成不同的<code>DataFetcherGenerator</code>对象赋值给<code>currentGenerator</code>；在<code>runGenerators()</code>方法中，循环调用了http请求，来请求图片数据，调用方法为<code>currentGenerator.startNext()</code>，在<code>startNext</code>方法中可以看到<code>loadData.fetcher.loadData()</code>方法来获取图片数据</p>
<blockquote>
<p>ResourceCacheGenerator类下的startNext()；第61行</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  List<span class="token operator">&lt;</span>Key<span class="token operator">></span> sourceIds <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getCacheKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceIds<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  List<span class="token operator">&lt;</span>Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">>></span> resourceClasses <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getRegisteredResourceClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceClasses<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">getTranscodeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
        <span class="token string">"Failed to find any load path from "</span>
            <span class="token operator">+</span> helper<span class="token punctuation">.</span><span class="token function">getModelClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">+</span> <span class="token string">" to "</span>
            <span class="token operator">+</span> helper<span class="token punctuation">.</span><span class="token function">getTranscodeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>modelLoaders <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">hasNextModelLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    resourceClassIndex<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceClassIndex <span class="token operator">>=</span> resourceClasses<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sourceIdIndex<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceIdIndex <span class="token operator">>=</span> sourceIds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      resourceClassIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Key sourceId <span class="token operator">=</span> sourceIds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sourceIdIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> resourceClass <span class="token operator">=</span> resourceClasses<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>resourceClassIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Transformation<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> transformation <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getTransformation</span><span class="token punctuation">(</span>resourceClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// PMD.AvoidInstantiatingObjectsInLoops Each iteration is comparatively expensive anyway,</span>
    <span class="token comment" spellcheck="true">// we only run until the first one succeeds, the loop runs for only a limited</span>
    <span class="token comment" spellcheck="true">// number of iterations on the order of 10-20 in the worst case.</span>
    currentKey <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">ResourceCacheKey</span><span class="token punctuation">(</span> <span class="token comment" spellcheck="true">// NOPMD AvoidInstantiatingObjectsInLoops</span>
            helper<span class="token punctuation">.</span><span class="token function">getArrayPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sourceId<span class="token punctuation">,</span>
            helper<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            helper<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            helper<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            transformation<span class="token punctuation">,</span>
            resourceClass<span class="token punctuation">,</span>
            helper<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cacheFile <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getDiskCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>currentKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheFile <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sourceKey <span class="token operator">=</span> sourceId<span class="token punctuation">;</span>
      modelLoaders <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getModelLoaders</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
      modelLoaderIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  loadData <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>started <span class="token operator">&amp;&amp;</span> <span class="token function">hasNextModelLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ModelLoader<span class="token operator">&lt;</span>File<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">></span> modelLoader <span class="token operator">=</span> modelLoaders<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>modelLoaderIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loadData <span class="token operator">=</span>
        modelLoader<span class="token punctuation">.</span><span class="token function">buildLoadData</span><span class="token punctuation">(</span>
            cacheFile<span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loadData <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> helper<span class="token punctuation">.</span><span class="token function">hasLoadPath</span><span class="token punctuation">(</span>loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">getDataClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> started<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>DataCacheGenerator类下的startNext()；第31行</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>modelLoaders <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">hasNextModelLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sourceIdIndex<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceIdIndex <span class="token operator">>=</span> cacheKeys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Key sourceId <span class="token operator">=</span> cacheKeys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sourceIdIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// PMD.AvoidInstantiatingObjectsInLoops The loop iterates a limited number of times</span>
    <span class="token comment" spellcheck="true">// and the actions it performs are much more expensive than a single allocation.</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"PMD.AvoidInstantiatingObjectsInLoops"</span><span class="token punctuation">)</span>
    Key originalKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataCacheKey</span><span class="token punctuation">(</span>sourceId<span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cacheFile <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getDiskCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>originalKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheFile <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sourceKey <span class="token operator">=</span> sourceId<span class="token punctuation">;</span>
      modelLoaders <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getModelLoaders</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
      modelLoaderIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  loadData <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>started <span class="token operator">&amp;&amp;</span> <span class="token function">hasNextModelLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ModelLoader<span class="token operator">&lt;</span>File<span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">></span> modelLoader <span class="token operator">=</span> modelLoaders<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>modelLoaderIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loadData <span class="token operator">=</span>
        modelLoader<span class="token punctuation">.</span><span class="token function">buildLoadData</span><span class="token punctuation">(</span>
            cacheFile<span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> helper<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loadData <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> helper<span class="token punctuation">.</span><span class="token function">hasLoadPath</span><span class="token punctuation">(</span>loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">getDataClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> started<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>SourceGenerator类下的startNext()；第29行</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dataToCache <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object data <span class="token operator">=</span> dataToCache<span class="token punctuation">;</span>
    dataToCache <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token function">cacheData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sourceCacheGenerator <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> sourceCacheGenerator<span class="token punctuation">.</span><span class="token function">startNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  sourceCacheGenerator <span class="token operator">=</span> null<span class="token punctuation">;</span>

  loadData <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>started <span class="token operator">&amp;&amp;</span> <span class="token function">hasNextModelLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    loadData <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getLoadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>loadDataListIndex<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loadData <span class="token operator">!=</span> null
        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>helper<span class="token punctuation">.</span><span class="token function">getDiskCacheStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDataCacheable</span><span class="token punctuation">(</span>loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> helper<span class="token punctuation">.</span><span class="token function">hasLoadPath</span><span class="token punctuation">(</span>loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">getDataClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">startNextLoad</span><span class="token punctuation">(</span>loadData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> started<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startNextLoad</span><span class="token punctuation">(</span><span class="token keyword">final</span> LoadData<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> toStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  loadData<span class="token punctuation">.</span>fetcher<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span>
      helper<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">DataCallback</span><span class="token operator">&lt;</span>Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDataReady</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> Object data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCurrentRequest</span><span class="token punctuation">(</span>toStart<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onDataReadyInternal</span><span class="token punctuation">(</span>toStart<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLoadFailed</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCurrentRequest</span><span class="token punctuation">(</span>toStart<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">onLoadFailedInternal</span><span class="token punctuation">(</span>toStart<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><code>loadData.fetcher.loadData()</code>方法中就是用了请求图片数据的，有很多实现类，下面取<code>HttpUrlFetcher</code>类的<code>loadData()</code>方法粘下代码看一下</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loadData</span><span class="token punctuation">(</span>
    <span class="token annotation punctuation">@NonNull</span> Priority priority<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> DataCallback<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> InputStream<span class="token operator">></span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> startTime <span class="token operator">=</span> LogTime<span class="token punctuation">.</span><span class="token function">getLogTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    InputStream result <span class="token operator">=</span> <span class="token function">loadDataWithRedirects</span><span class="token punctuation">(</span>glideUrl<span class="token punctuation">.</span><span class="token function">toURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> glideUrl<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback<span class="token punctuation">.</span><span class="token function">onDataReady</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Log<span class="token punctuation">.</span><span class="token function">isLoggable</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> Log<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Failed to load data for url"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    callback<span class="token punctuation">.</span><span class="token function">onLoadFailed</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Log<span class="token punctuation">.</span><span class="token function">isLoggable</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> Log<span class="token punctuation">.</span>VERBOSE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Log<span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Finished http url fetcher fetch in "</span> <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> InputStream <span class="token function">loadDataWithRedirects</span><span class="token punctuation">(</span>
    URL url<span class="token punctuation">,</span> <span class="token keyword">int</span> redirects<span class="token punctuation">,</span> URL lastUrl<span class="token punctuation">,</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> headers<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>redirects <span class="token operator">>=</span> MAXIMUM_REDIRECTS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">"Too many (> "</span> <span class="token operator">+</span> MAXIMUM_REDIRECTS <span class="token operator">+</span> <span class="token string">") redirects!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Comparing the URLs using .equals performs additional network I/O and is generally broken.</span>
    <span class="token comment" spellcheck="true">// See http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html.</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>lastUrl <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>lastUrl<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">"In re-direct loop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">URISyntaxException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Do nothing, this is best effort.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  urlConnection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>Map<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> headerEntry <span class="token operator">:</span> headers<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    urlConnection<span class="token punctuation">.</span><span class="token function">addRequestProperty</span><span class="token punctuation">(</span>headerEntry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> headerEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">setUseCaches</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">setDoInput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Stop the urlConnection instance of HttpUrlConnection from following redirects so that</span>
  <span class="token comment" spellcheck="true">// redirects will be handled by recursive calls to this method, loadDataWithRedirects.</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">setInstanceFollowRedirects</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Connect explicitly to avoid errors in decoders if connection fails.</span>
  urlConnection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// Set the stream so that it's closed in cleanup to avoid resource leaks. See #2352.</span>
  stream <span class="token operator">=</span> urlConnection<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isCancelled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">final</span> <span class="token keyword">int</span> statusCode <span class="token operator">=</span> urlConnection<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isHttpOk</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getStreamForSuccessfulRequest</span><span class="token punctuation">(</span>urlConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isHttpRedirect</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    String redirectUrlString <span class="token operator">=</span> urlConnection<span class="token punctuation">.</span><span class="token function">getHeaderField</span><span class="token punctuation">(</span><span class="token string">"Location"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TextUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>redirectUrlString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">"Received empty or null redirect url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    URL redirectUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> redirectUrlString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Closing the stream specifically is required to avoid leaking ResponseBodys in addition</span>
    <span class="token comment" spellcheck="true">// to disconnecting the url connection below. See #2352.</span>
    <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">loadDataWithRedirects</span><span class="token punctuation">(</span>redirectUrl<span class="token punctuation">,</span> redirects <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> INVALID_STATUS_CODE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span>urlConnection<span class="token punctuation">.</span><span class="token function">getResponseMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>在<code>loadDataWithRedirects</code>方法中可以看到网络请求的操作，之后返回请求的数据流；到这里就拿到请求的数据了，然后应该回显到target上</p>
<p>可以看到在请求的回调方法<code>onDataReady</code>中，调用回调函数<code>cb.onDataFetcherReady()</code>回调到<code>DecodeJob</code>对象中</p>
<blockquote>
<p><code>DecodeJob</code>对象中的 <code>onDataFetcherReady()</code>方法</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDataFetcherReady</span><span class="token punctuation">(</span>
    Key sourceKey<span class="token punctuation">,</span> Object data<span class="token punctuation">,</span> DataFetcher<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> fetcher<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">,</span> Key attemptedKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentSourceKey <span class="token operator">=</span> sourceKey<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentData <span class="token operator">=</span> data<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentFetcher <span class="token operator">=</span> fetcher<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentDataSource <span class="token operator">=</span> dataSource<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currentAttemptingKey <span class="token operator">=</span> attemptedKey<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> currentThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    runReason <span class="token operator">=</span> RunReason<span class="token punctuation">.</span>DECODE_DATA<span class="token punctuation">;</span>
    callback<span class="token punctuation">.</span><span class="token function">reschedule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    GlideTrace<span class="token punctuation">.</span><span class="token function">beginSection</span><span class="token punctuation">(</span><span class="token string">"DecodeJob.decodeFromRetrievedData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">decodeFromRetrievedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      GlideTrace<span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDataFetcherFailed</span><span class="token punctuation">(</span>
    Key attemptedKey<span class="token punctuation">,</span> Exception e<span class="token punctuation">,</span> DataFetcher<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> fetcher<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fetcher<span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  GlideException exception <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GlideException</span><span class="token punctuation">(</span><span class="token string">"Fetching data failed"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  exception<span class="token punctuation">.</span><span class="token function">setLoggingDetails</span><span class="token punctuation">(</span>attemptedKey<span class="token punctuation">,</span> dataSource<span class="token punctuation">,</span> fetcher<span class="token punctuation">.</span><span class="token function">getDataClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  throwables<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> currentThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    runReason <span class="token operator">=</span> RunReason<span class="token punctuation">.</span>SWITCH_TO_SOURCE_SERVICE<span class="token punctuation">;</span>
    callback<span class="token punctuation">.</span><span class="token function">reschedule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">runGenerators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">decodeFromRetrievedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Log<span class="token punctuation">.</span><span class="token function">isLoggable</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> Log<span class="token punctuation">.</span>VERBOSE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span>
        <span class="token string">"Retrieved data"</span><span class="token punctuation">,</span>
        startFetchTime<span class="token punctuation">,</span>
        <span class="token string">"data: "</span>
            <span class="token operator">+</span> currentData
            <span class="token operator">+</span> <span class="token string">", cache key: "</span>
            <span class="token operator">+</span> currentSourceKey
            <span class="token operator">+</span> <span class="token string">", fetcher: "</span>
            <span class="token operator">+</span> currentFetcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> resource <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    resource <span class="token operator">=</span> <span class="token function">decodeFromData</span><span class="token punctuation">(</span>currentFetcher<span class="token punctuation">,</span> currentData<span class="token punctuation">,</span> currentDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">GlideException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">setLoggingDetails</span><span class="token punctuation">(</span>currentAttemptingKey<span class="token punctuation">,</span> currentDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    throwables<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">notifyEncodeAndRelease</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> currentDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">runGenerators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">notifyEncodeAndRelease</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> resource<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token keyword">instanceof</span> <span class="token class-name">Initializable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span>Initializable<span class="token punctuation">)</span> resource<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> result <span class="token operator">=</span> resource<span class="token punctuation">;</span>
  LockedResource<span class="token operator">&lt;</span>R<span class="token operator">></span> lockedResource <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>deferredEncodeManager<span class="token punctuation">.</span><span class="token function">hasResourceToEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lockedResource <span class="token operator">=</span> LockedResource<span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> lockedResource<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">notifyComplete</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  stage <span class="token operator">=</span> Stage<span class="token punctuation">.</span>ENCODE<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deferredEncodeManager<span class="token punctuation">.</span><span class="token function">hasResourceToEncode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      deferredEncodeManager<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>diskCacheProvider<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lockedResource <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      lockedResource<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">// Call onEncodeComplete outside the finally block so that it's not called if the encode process</span>
  <span class="token comment" spellcheck="true">// throws.</span>
  <span class="token function">onEncodeComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">notifyComplete</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> resource<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setNotifiedOrThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>在<code>onDataFetcherReady</code>方法中调用<code>decodeFromRetrievedData();</code>方法进行解码图片数据，成功拿到解码后的图片资源数据之后，调用<code>notifyEncodeAndRelease</code>方法将<code>Resource&lt;R&gt;</code>对象封装成<code>LockedResource</code>对象，并调用<code>notifyComplete(result, dataSource);</code>方法，在<code>notifyComplete(result, dataSource);</code>方法中通过<code>callback.onResourceReady(resource, dataSource)</code>将资源数据回调到<code>EngineJob&lt;R&gt;</code>对象中的<code>onResourceReady</code>方法</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> resource<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> resource<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> dataSource<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">notifyCallbacksOfResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>GlideException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>exception <span class="token operator">=</span> e<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">notifyCallbacksOfException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">notifyCallbacksOfResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ResourceCallbacksAndExecutors copy<span class="token punctuation">;</span>
    Key localKey<span class="token punctuation">;</span>
    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> localResource<span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isCancelled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resource<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Received a resource without any callbacks to notify"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hasResource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">"Already have resource"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      engineResource <span class="token operator">=</span> engineResourceFactory<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> isCacheable<span class="token punctuation">,</span> key<span class="token punctuation">,</span> resourceListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
      hasResource <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      copy <span class="token operator">=</span> cbs<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">incrementPendingCallbacks</span><span class="token punctuation">(</span>copy<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      localKey <span class="token operator">=</span> key<span class="token punctuation">;</span>
      localResource <span class="token operator">=</span> engineResource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    engineJobListener<span class="token punctuation">.</span><span class="token function">onEngineJobComplete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> localKey<span class="token punctuation">,</span> localResource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> ResourceCallbackAndExecutor entry <span class="token operator">:</span> copy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entry<span class="token punctuation">.</span>executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CallResourceReady</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">decrementPendingCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"WeakerAccess"</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Synthetic</span>
  <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">incrementPendingCallbacks</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Preconditions<span class="token punctuation">.</span><span class="token function">checkArgument</span><span class="token punctuation">(</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Not yet complete!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingCallbacks<span class="token punctuation">.</span><span class="token function">getAndAdd</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> engineResource <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      engineResource<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"WeakerAccess"</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Synthetic</span>
  <span class="token keyword">void</span> <span class="token function">decrementPendingCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    EngineResource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> toRelease <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Preconditions<span class="token punctuation">.</span><span class="token function">checkArgument</span><span class="token punctuation">(</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Not yet complete!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> decremented <span class="token operator">=</span> pendingCallbacks<span class="token punctuation">.</span><span class="token function">decrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Preconditions<span class="token punctuation">.</span><span class="token function">checkArgument</span><span class="token punctuation">(</span>decremented <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Can't decrement below 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>decremented <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        toRelease <span class="token operator">=</span> engineResource<span class="token punctuation">;</span>

        <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>toRelease <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      toRelease<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre>
<p>在<code>EngineJob&lt;R&gt;</code>对象中的<code>onResourceReady</code>方法中通过第45行执行<code>CallResourceReady</code>这个<code>Runnable</code>的实现类，</p>
<p><code>CallResourceReady</code>实现类如下：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">CallResourceReady</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> ResourceCallback cb<span class="token punctuation">;</span>

  <span class="token function">CallResourceReady</span><span class="token punctuation">(</span>ResourceCallback cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Make sure we always acquire the request lock, then the EngineJob lock to avoid deadlock</span>
    <span class="token comment" spellcheck="true">// (b/136032534).</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>cb<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>EngineJob<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cbs<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// Acquire for this particular callback.</span>
          engineResource<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">callCallbackOnResourceReady</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">removeCallback</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">decrementPendingCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>在这个实现类中的run方法里，调用了<code>EngineJob&lt;R&gt;</code>对象的<code>callCallbackOnResourceReady</code>方法</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"WeakerAccess"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Synthetic</span>
<span class="token annotation punctuation">@GuardedBy</span><span class="token punctuation">(</span><span class="token string">"this"</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">callCallbackOnResourceReady</span><span class="token punctuation">(</span>ResourceCallback cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// This is overly broad, some Glide code is actually called here, but it's much</span>
    <span class="token comment" spellcheck="true">// simpler to encapsulate here than to do so at the actual call point in the</span>
    <span class="token comment" spellcheck="true">// Request implementation.</span>
    cb<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>engineResource<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CallbackException</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>在这个方法中通过<code>ResourceCallback</code>回调接口类的<code>onResourceReady</code>回调到<code>SingleRequest</code>对象中</p>
<p>再贴一下<code>SingleRequest</code>对象中的代码</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> resource<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stateVerifier<span class="token punctuation">.</span><span class="token function">throwIfRecycled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Resource<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> toRelease <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>requestLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      loadStatus <span class="token operator">=</span> null<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resource <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        GlideException exception <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">GlideException</span><span class="token punctuation">(</span>
                <span class="token string">"Expected to receive a Resource&lt;R> with an "</span>
                    <span class="token operator">+</span> <span class="token string">"object of "</span>
                    <span class="token operator">+</span> transcodeClass
                    <span class="token operator">+</span> <span class="token string">" inside, but instead got null."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      Object received <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>received <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token operator">!</span>transcodeClass<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>received<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        toRelease <span class="token operator">=</span> resource<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> null<span class="token punctuation">;</span>
        GlideException exception <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">GlideException</span><span class="token punctuation">(</span>
                <span class="token string">"Expected to receive an object of "</span>
                    <span class="token operator">+</span> transcodeClass
                    <span class="token operator">+</span> <span class="token string">" but instead"</span>
                    <span class="token operator">+</span> <span class="token string">" got "</span>
                    <span class="token operator">+</span> <span class="token punctuation">(</span>received <span class="token operator">!=</span> null <span class="token operator">?</span> received<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span>
                    <span class="token operator">+</span> <span class="token string">"{"</span>
                    <span class="token operator">+</span> received
                    <span class="token operator">+</span> <span class="token string">"} inside"</span>
                    <span class="token operator">+</span> <span class="token string">" "</span>
                    <span class="token operator">+</span> <span class="token string">"Resource{"</span>
                    <span class="token operator">+</span> resource
                    <span class="token operator">+</span> <span class="token string">"}."</span>
                    <span class="token operator">+</span> <span class="token punctuation">(</span>received <span class="token operator">!=</span> null
                        <span class="token operator">?</span> <span class="token string">""</span>
                        <span class="token operator">:</span> <span class="token string">" "</span>
                            <span class="token operator">+</span> <span class="token string">"To indicate failure return a null Resource "</span>
                            <span class="token operator">+</span> <span class="token string">"object, rather than a Resource object containing null data."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canSetResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        toRelease <span class="token operator">=</span> resource<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// We can't put the status to complete before asking canSetResource().</span>
        status <span class="token operator">=</span> Status<span class="token punctuation">.</span>COMPLETE<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">onResourceReady</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span>R<span class="token operator">></span><span class="token punctuation">)</span> resource<span class="token punctuation">,</span> <span class="token punctuation">(</span>R<span class="token punctuation">)</span> received<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>toRelease <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      engine<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>toRelease<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * Internal {@link #onResourceReady(Resource, DataSource)} where arguments are known to be safe.
 *
 * @param resource original {@link Resource}, never &lt;code>null&lt;/code>
 * @param result object returned by {@link Resource#get()}, checked for type and never &lt;code>null
 *     &lt;/code>
 */</span>
<span class="token annotation punctuation">@GuardedBy</span><span class="token punctuation">(</span><span class="token string">"requestLock"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span>Resource<span class="token operator">&lt;</span>R<span class="token operator">></span> resource<span class="token punctuation">,</span> R result<span class="token punctuation">,</span> DataSource dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// We must call isFirstReadyResource before setting status.</span>
  <span class="token keyword">boolean</span> isFirstResource <span class="token operator">=</span> <span class="token function">isFirstReadyResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  status <span class="token operator">=</span> Status<span class="token punctuation">.</span>COMPLETE<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> resource<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>glideContext<span class="token punctuation">.</span><span class="token function">getLogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> Log<span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
        GLIDE_TAG<span class="token punctuation">,</span>
        <span class="token string">"Finished loading "</span>
            <span class="token operator">+</span> result<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">+</span> <span class="token string">" from "</span>
            <span class="token operator">+</span> dataSource
            <span class="token operator">+</span> <span class="token string">" for "</span>
            <span class="token operator">+</span> model
            <span class="token operator">+</span> <span class="token string">" with size ["</span>
            <span class="token operator">+</span> width
            <span class="token operator">+</span> <span class="token string">"x"</span>
            <span class="token operator">+</span> height
            <span class="token operator">+</span> <span class="token string">"] in "</span>
            <span class="token operator">+</span> LogTime<span class="token punctuation">.</span><span class="token function">getElapsedMillis</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span>
            <span class="token operator">+</span> <span class="token string">" ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  isCallingCallbacks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> anyListenerHandledUpdatingTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requestListeners <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>RequestListener<span class="token operator">&lt;</span>R<span class="token operator">></span> listener <span class="token operator">:</span> requestListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        anyListenerHandledUpdatingTarget <span class="token operator">|=</span>
            listener<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> model<span class="token punctuation">,</span> target<span class="token punctuation">,</span> dataSource<span class="token punctuation">,</span> isFirstResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    anyListenerHandledUpdatingTarget <span class="token operator">|=</span>
        targetListener <span class="token operator">!=</span> null
            <span class="token operator">&amp;&amp;</span> targetListener<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> model<span class="token punctuation">,</span> target<span class="token punctuation">,</span> dataSource<span class="token punctuation">,</span> isFirstResource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>anyListenerHandledUpdatingTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Transition<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> R<span class="token operator">></span> animation <span class="token operator">=</span> animationFactory<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">,</span> isFirstResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      target<span class="token punctuation">.</span><span class="token function">onResourceReady</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    isCallingCallbacks <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">notifyLoadSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/** A callback method that should never be invoked directly. */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>GlideException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> Log<span class="token punctuation">.</span>WARN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>在这里方法里通过<code>target.onResourceReady</code>回调方法，将请求到数图片数据显示到目标view上。</p>
<p>至此，Glide加载的原理浅析就完成了，望共勉！</p>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/about">一个人的旅行</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/20200403/5d609221eb6a/">https://blog.onestravel.cn/20200403/5d609221eb6a/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/20210128/3659e5f3ab6f/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">【笔记一】Java程序运行时，内存是如何分配的 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/20200320/57ca58f70f21/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">FiveFiveVideoPlayer 一个可以高度自定义的播放器 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content comment-card" style="margin-top: 16px;">
  <div class="comment-card-title">评论</div>
  
  <div id="gitalk-container"></div>
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

  
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  
<script src="/js/lib/md5.min.js"></script>

  <script>
    var gitalk = new Gitalk({
      clientID: 'a52a65db0a634019e27f',
      clientSecret: 'a04eaebc103e73d3769221171a4b87b55b39998d',
      repo: 'onestravel.github.io',
      owner: 'onestravel',
      admin: "onestravel",
      id: md5(location.href),
      distractionFreeMode: true,
      language: 'navigator.language || navigator.userLanguage',
      labels: ["Gitalk"],
      perPage: 10
    })

    gitalk.render('gitalk-container')
  </script>

</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Glide-4-11-0-%E6%B5%85%E6%9E%90"><span class="toc-text">Glide-4.11.0 浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-with"><span class="toc-text">1. with</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-load"><span class="toc-text">2. load</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-into"><span class="toc-text">3. into</span></a></li></ol></li></ol></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/medias/avatar.jpg" class="author-img">

<p class="author-name">一个人的旅行</p>
<p class="author-description">冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>69</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>14</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>47</span>
    <span>标签</span>
  </a>
</div>

<div class="author-card-society">
  
    <div class="author-card-society-icon">
      <a target="_blank" rel="noopener" href="https://github.com/onestravel">
        <i class="iconfont icon-github society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a href="mailto:service@onestravel.cn">
        <i class="iconfont icon-mail society-icon"></i>
      </a>
    </div>
  
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Glide-4-11-0-%E6%B5%85%E6%9E%90"><span class="toc-text">Glide-4.11.0 浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-with"><span class="toc-text">1. with</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-load"><span class="toc-text">2. load</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-into"><span class="toc-text">3. into</span></a></li></ol></li></ol></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
      <a href="/categories/NDK/">
        <div class="categories-list-item">
          NDK
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Android/">
        <div class="categories-list-item">
          Android
          <span class="categories-list-item-badge">9</span>
        </div>
      </a>
    
      <a href="/categories/CPlusPlus/">
        <div class="categories-list-item">
          CPlusPlus
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/C/">
        <div class="categories-list-item">
          C
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/前端H5/">
        <div class="categories-list-item">
          前端H5
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/JNI/">
        <div class="categories-list-item">
          JNI
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/算法/">
        <div class="categories-list-item">
          算法
          <span class="categories-list-item-badge">18</span>
        </div>
      </a>
    
      <a href="/categories/DevTools/">
        <div class="categories-list-item">
          DevTools
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/SpringBoot/">
        <div class="categories-list-item">
          SpringBoot
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Jenkins/">
        <div class="categories-list-item">
          Jenkins
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Kotlin/">
        <div class="categories-list-item">
          Kotlin
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/Linux/">
        <div class="categories-list-item">
          Linux
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/JAVA/">
        <div class="categories-list-item">
          JAVA
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Git/">
        <div class="categories-list-item">
          Git
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
    <a href="/tags/Android/" title="Android"><div class="tags-list-item">Android</div></a>
    
    <a href="/tags/Kotlin/" title="Kotlin"><div class="tags-list-item">Kotlin</div></a>
    
    <a href="/tags/CPlusPlus/" title="CPlusPlus"><div class="tags-list-item">CPlusPlus</div></a>
    
    <a href="/tags/NDK/" title="NDK"><div class="tags-list-item">NDK</div></a>
    
    <a href="/tags/C/" title="C"><div class="tags-list-item">C</div></a>
    
    <a href="/tags/JVM/" title="JVM"><div class="tags-list-item">JVM</div></a>
    
    <a href="/tags/数组/" title="数组"><div class="tags-list-item">数组</div></a>
    
    <a href="/tags/自动化部署/" title="自动化部署"><div class="tags-list-item">自动化部署</div></a>
    
    <a href="/tags/Jenkins/" title="Jenkins"><div class="tags-list-item">Jenkins</div></a>
    
    <a href="/tags/斐波那契数列/" title="斐波那契数列"><div class="tags-list-item">斐波那契数列</div></a>
    
    <a href="/tags/Intellij-IDEA/" title="Intellij IDEA"><div class="tags-list-item">Intellij IDEA</div></a>
    
    <a href="/tags/html/" title="html"><div class="tags-list-item">html</div></a>
    
    <a href="/tags/JNI/" title="JNI"><div class="tags-list-item">JNI</div></a>
    
    <a href="/tags/Linux/" title="Linux"><div class="tags-list-item">Linux</div></a>
    
    <a href="/tags/矩阵/" title="矩阵"><div class="tags-list-item">矩阵</div></a>
    
    <a href="/tags/centos/" title="centos"><div class="tags-list-item">centos</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Glide-4-11-0-%E6%B5%85%E6%9E%90"><span class="toc-text">Glide-4.11.0 浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-with"><span class="toc-text">1. with</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-load"><span class="toc-text">2. load</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-into"><span class="toc-text">3. into</span></a></li></ol></li></ol></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-09-20</div>
        <a href="/20210920/f8c53c115779/"><div class="recent-posts-item-content">【并发编程】线程基础</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-07-28</div>
        <a href="/20210728/9c2efe6aefcb/"><div class="recent-posts-item-content">【笔记四】编译插桩操纵字节码，实现不可能完成的任务</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-05-28</div>
        <a href="/20210528/618470f841d8/"><div class="recent-posts-item-content">【笔记三】字节码层面分析 class 文件结构</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-03-28</div>
        <a href="/20210328/68b72d473df5/"><div class="recent-posts-item-content">【笔记二】GC 回收机制和分代回收策略</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2022
        </span>
        &nbsp;
        <a href="/" class="footer-link">一个人的旅行 </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
      <div class="footer-dsc">
        
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
        <span>&nbsp;|&nbsp;</span>
        
        
        本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton"  aria-label="回到顶部">
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton" aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget" aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget" aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  

  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('aria-label', 'illustration');
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      if (img[i].alt) wrapper.dataset.caption = img[i].alt;
      wrapper.dataset.nolink = true;
      img[i].before(wrapper);
      wrapper.append(img[i]);
      var divWrap = document.createElement('div');
      divWrap.classList.add('gallery');
      wrapper.before(divWrap);
      divWrap.append(wrapper);
    }
    baguetteBox.run('.gallery');
  }
</script>
<script>loadScript("/js/lib/lightbox/baguetteBox.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  <script>loadScript("/js/lib/busuanzi.min.js")</script>
  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
  <script>
    var googleAnalytics = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-145377665-1');
    }
  </script>
  <script>loadScript("https://www.googletagmanager.com/gtag/js?id=" + "UA-145377665-1", googleAnalytics)</script>
  
</body>

</html>