<!DOCTYPE html>
<html  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <meta name="description" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  <link rel="icon" href="/favicon.png">
  <title>AndroidStudio下集成Fmod，实现仿QQ变声效果（一）</title>
  
  
  <meta property="og:title" content="AndroidStudio下集成Fmod，实现仿QQ变声效果（一）">
  
  
  <meta property="og:url" content="https://blog.onestravel.cn/20190310/9fcf14b14bdc/index.html">
  
  
  <meta property="og:img" content="/images/20190310/fmod-player.jpg">
  
  
  <meta property="og:img" content="冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！">
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2019-03-10">
  <meta property="og:article:modified_time" content="2022-10-08">
  <meta property="og:article:author" content="一个人的旅行">
  
  
  <meta property="og:article:tag" content="Android">
  
  <meta property="og:article:tag" content="NDK">
  
  <meta property="og:article:tag" content="Fmod">
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
  <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" as="script">
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" as="script">
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
<link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/favicon.png" alt="logo">
      
      <span class="navbar-logo-dsc">一个人的旅行</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于
    
    </a>
    
    <a href="/friends" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<div class="image-wrapper">
  <img src="/images/20190310/fmod-player.jpg" data-src="/images/20190310/fmod-player.jpg"
    srcset="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20300%20300&#39;%3E%3C/svg%3E"
    class="image lozad"
    alt="thumbnail"
  >
</div>

<article class="card card-content">
  <header>
    <h1 class="post-title">
      AndroidStudio下集成Fmod，实现仿QQ变声效果（一）
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2019-03-10T00:25:00.000Z">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2019-03-10</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/NDK/" class="post-meta-link">NDK</a>
    
    
    
    <span class="dot"></span>
    <span>3.6k 字</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/Android/" class="post-meta-link">Android</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/NDK/" class="post-meta-link">NDK</a>
      
      
      <span class="dot"></span>
      
        <a href="/tags/Fmod/" class="post-meta-link">Fmod</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <h1 id="AndroidStudio下集成Fmod，实现仿QQ变声效果"><a href="#AndroidStudio下集成Fmod，实现仿QQ变声效果" class="headerlink" title="AndroidStudio下集成Fmod，实现仿QQ变声效果"></a>AndroidStudio下集成Fmod，实现仿QQ变声效果</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>在使用QQ的时候，我们会发现有一个炫酷的功能，那就是变声，效果图如下;其实QQ变声效果就是使用了Fmod声音引擎，通过NDK的开发，来实现对声音的变换。今天我们先进行一下QQ变声效果的前期实现，先引入Fmod库，实现音频文件的播放</strong><br><img src="/images/20190310/qq_voice_change.png" alt="QQ变声" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/qq_voice_change.png" class="lozad post-image"></p>
<h2 id="一、前期准备"><a href="#一、前期准备" class="headerlink" title="一、前期准备"></a>一、前期准备</h2><ul>
<li><strong><a target="_blank" rel="noopener" href="https://www.fmod.com/download">【Fmod下载】</a></strong>：点击该连接后，进行注册，登录以后再下载,选择版本<br><img src="/images/20190310/fmod_download.png" alt="Fmod下载" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/fmod_download.png" class="lozad post-image"></li>
<li><strong>【Android Studio】</strong>：Android Studio实现NDK支持<br><img src="/images/20190310/ndk_download.png" alt="NDK下载" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/ndk_download.png" class="lozad post-image"></li>
</ul>
<h2 id="二、实现使用fmod播放assets下的音频"><a href="#二、实现使用fmod播放assets下的音频" class="headerlink" title="二、实现使用fmod播放assets下的音频"></a>二、实现使用fmod播放assets下的音频</h2><h3 id="1、创建一个支持C-的Android项目"><a href="#1、创建一个支持C-的Android项目" class="headerlink" title="1、创建一个支持C++的Android项目"></a>1、创建一个支持C++的Android项目</h3><p><img src="/images/20190310/create_1.png" alt="创建支持C++的Android项目-1" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/create_1.png" class="lozad post-image"></p>
<p><img src="/images/20190310/create_2.png" alt="创建支持C++的Android项目-2" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/create_2.png" class="lozad post-image"></p>
<p><img src="/images/20190310/create_3.png" alt="创建支持C++的Android项目-3" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/images/20190310/create_3.png" class="lozad post-image"></p>
<p><strong>创建好之后会在app/src/main 下面看到cpp文件夹，这就是进行NDK开发的C/C++层的文件夹</strong></p>
<h3 id="2、配置Android项目"><a href="#2、配置Android项目" class="headerlink" title="2、配置Android项目"></a>2、配置Android项目</h3><ul>
<li>在 app/src/main 下创建 jniLibs 文件夹</li>
<li>将下载好的fmod包打开，进入到 api/lowlevel/ 下，可以看到 examples 、inc 、lib 三个文件夹</li>
<li>将 inc 文件夹整体复制到 src/main/cpp 目录下</li>
<li>将 lib 文件夹下的 fmod.jar 复制到 libs 目录下，并且右键该jar包，Add As Library </li>
<li>将 lib 文件夹下的 so 动态库的不同平台的文件夹复制到 刚刚创建好的 jniLibs 目录下</li>
<li>将 examples 目录下的common.h,common.cpp,common_platform.h,common_platform.cpp,play_sound.cpp 文件复制到src/main/cpp 目录下</li>
<li>修改common.h中 #include “fmod.h” 为 #include “inc/fmod.h”</li>
<li>修改common.cpp中 #include “fmod_errors.h” 为 #include “inc/fmod_errors.h”</li>
<li>修改play_sound.cpp中 #include “fmod.hpp” 为 #include “inc/fmod.hpp”</li>
<li>将 examples/java 下的org文件夹整个赋值到 src/main/java 目录下，并修改 AndroidManifest.xml 中的启动类为  org.fmod.example.MainActivity</li>
<li>在app下的build.gradle 中的 defaultConfig 木块中新增 NDK 配置</li>
</ul>
<pre><code>    ndk &#123;
            abiFilters &quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;
        &#125;</code></pre><ul>
<li>将引入的so动态库和play_sound.cpp等加入到 CMakeLists.txt 文件中，具体配置如下：</li>
</ul>
<pre><code>cmake_minimum_required(VERSION 3.4.1)

set(distribution_DIR $&#123;PROJECT_SOURCE_DIR&#125;../../jniLibs)
include_directories(src/main/cpp/inc)
add_library( sound
        SHARED
        play_sound.cpp
        common.cpp
        common_platform.cpp)
add_library( fmod
        SHARED
        IMPORTED )
set_target_properties( fmod
        PROPERTIES IMPORTED_LOCATION
        $&#123;distribution_DIR&#125;/$&#123;ANDROID_ABI&#125;/libfmod.so)
add_library( fmodL
        SHARED
        IMPORTED )
set_target_properties( fmodL
        PROPERTIES IMPORTED_LOCATION
        $&#123;distribution_DIR&#125;/$&#123;ANDROID_ABI&#125;/libfmodL.so )
find_library( # Sets the name of the path variable.
        log-lib
        log)
target_link_libraries( sound
        fmod
        fmodL
        $&#123;log-lib&#125; )
</code></pre><ul>
<li>修改 org.fmod.example.MainActivity 中的static 方法,删除一些未引入的library，更改刚刚在 CMakeLists.txt 文件中定义的library 如下：</li>
</ul>
<pre><code> static &#123;
        try &#123;
            System.loadLibrary(&quot;fmodL&quot;);
        &#125; catch (UnsatisfiedLinkError e) &#123;
        &#125;
        try &#123;
            System.loadLibrary(&quot;fmod&quot;);
        &#125; catch (UnsatisfiedLinkError e) &#123;
        &#125;
        System.loadLibrary(&quot;sound&quot;);
    &#125;</code></pre><ul>
<li>将 examples/media 文件夹下的音频资源文件复制到项目的 assets 目录下，具体文件引入可查看 play_sound.cpp 文件42~52行；这里将所有后缀为 .wav 和 .mp3 的文件都复制到 assets 目录下。</li>
</ul>
<pre><code>    result = system-&gt;createSound(Common_MediaPath(&quot;drumloop.wav&quot;), FMOD_DEFAULT, 0, &amp;sound1);
    ERRCHECK(result);

    result = sound1-&gt;setMode(FMOD_LOOP_OFF);    /* drumloop.wav has embedded loop points which automatically makes looping turn on, */
    ERRCHECK(result);                           /* so turn it off here.  We could have also just put FMOD_LOOP_OFF in the above CreateSound call. */

    result = system-&gt;createSound(Common_MediaPath(&quot;jaguar.wav&quot;), FMOD_DEFAULT, 0, &amp;sound2);
    ERRCHECK(result);

    result = system-&gt;createSound(Common_MediaPath(&quot;swish.wav&quot;), FMOD_DEFAULT, 0, &amp;sound3);
    ERRCHECK(result);</code></pre><ul>
<li>到这里，我们所有的步骤都已经完成了，可以成功运行项目了，项目运行起来后，我们可以看到界面上加载了三首音频文件，分别对应 A , B , C 三个按钮，我们点击这三个按钮，就可以播放对应的音频文件</li>
</ul>
<h2 id="三、项目改造"><a href="#三、项目改造" class="headerlink" title="三、项目改造"></a>三、项目改造</h2><p><strong>第二部的操作是完全使用了 fmod 的示例来完成 assets 目录下的音频文件的播放，我们可以看到这个是使用的 org.fmod.example.MainActivity 进行播放的，我们接下来将播放的 native 方法抽取成一个 utils 类，然后再自己的MainActivity中调用（使用org.fmod.example.MainActivity的布局）；然后再添加点击 D 和 E 按钮时播放音频文件的功能</strong></p>
<h3 id="1、抽取-FmodUtils-java-工具类，使用自己包路径下的-MainActivity-实现播放"><a href="#1、抽取-FmodUtils-java-工具类，使用自己包路径下的-MainActivity-实现播放" class="headerlink" title="1、抽取 FmodUtils.java 工具类，使用自己包路径下的 MainActivity 实现播放"></a>1、抽取 FmodUtils.java 工具类，使用自己包路径下的 MainActivity 实现播放</h3><h4 id="1-1-FmodUtils-java-类如下，在原有main-方法加了参数，传入Activity实例："><a href="#1-1-FmodUtils-java-类如下，在原有main-方法加了参数，传入Activity实例：" class="headerlink" title="1.1 FmodUtils.java 类如下，在原有main()方法加了参数，传入Activity实例："></a>1.1 FmodUtils.java 类如下，在原有main()方法加了参数，传入Activity实例：</h4><pre><code>package org.fmod.core;

import android.app.Activity;

/**
 * @author onestravel
 * @version 1.0.0
 * @name org.fmod.example.FmodUtils
 * @description //TODO
 */
public class FmodUtils &#123;
    private static FmodUtils mInstance;

    private FmodUtils() &#123;

    &#125;

    public static FmodUtils getInstance() &#123;
        synchronized (FmodUtils.class) &#123;
            if (mInstance == null) &#123;
                mInstance = new FmodUtils();
            &#125;
        &#125;
        return mInstance;
    &#125;


    public native String getButtonLabel(int index);
    public native void buttonDown(int index);
    public native void buttonUp(int index);
    public native void setStateCreate();
    public native void setStateStart();
    public native void setStateStop();
    public native void setStateDestroy();
    public native void main(Activity context);

    static
    &#123;
        try &#123; 
            System.loadLibrary(&quot;fmodL&quot;);
        &#125;
        catch (UnsatisfiedLinkError e) &#123; &#125;
        try &#123; 
            System.loadLibrary(&quot;fmod&quot;);
        &#125;
        catch (UnsatisfiedLinkError e) &#123; &#125;

        System.loadLibrary(&quot;sound&quot;);
    &#125;
&#125;
</code></pre><h4 id="1-2-更改cpp-文件中的-native-函数"><a href="#1-2-更改cpp-文件中的-native-函数" class="headerlink" title="1.2 更改cpp 文件中的 native 函数"></a>1.2 更改cpp 文件中的 native 函数</h4><p><strong>更改 common_platform.cpp 文件中对应的 native 函数名称(154~200行)</strong></p>
<pre><code>#include &quot;common.h&quot;
#include &lt;string.h&gt;
#include &lt;jni.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string&gt;
#include &lt;vector&gt;

JNIEnv *gJNIEnv;
jobject gMainActivityObject;
int gDownButtons;
int gLastDownButtons;
int gPressedButtons;
bool gSuspendState;
bool gQuitState;
std::string gUIString;
std::vector&lt;char *&gt; gPathList;

int FMOD_Main(); // Defined in example

void Common_Init(void **extraDriverData)
&#123;
    gDownButtons = 0;
    gLastDownButtons = 0;
    gPressedButtons = 0;
    gSuspendState = false;
    gQuitState = false;
&#125;

void Common_Close()
&#123;
    for (std::vector&lt;char *&gt;::iterator item = gPathList.begin(); item != gPathList.end(); ++item)
    &#123;
        free(*item);
    &#125;

    gPathList.clear();
&#125;

void Common_Update()
&#123;
    jstring text = gJNIEnv-&gt;NewStringUTF(gUIString.c_str());
    jclass mainActivityClass = gJNIEnv-&gt;GetObjectClass(gMainActivityObject);
    jmethodID updateScreenMethodID = gJNIEnv-&gt;GetMethodID(mainActivityClass, &quot;updateScreen&quot;, &quot;(Ljava/lang/String;)V&quot;);

    gJNIEnv-&gt;CallVoidMethod(gMainActivityObject, updateScreenMethodID, text);

    gJNIEnv-&gt;DeleteLocalRef(text);
    gJNIEnv-&gt;DeleteLocalRef(mainActivityClass);

    gUIString.clear();

    gPressedButtons = (gLastDownButtons ^ gDownButtons) &amp; gDownButtons;
    gLastDownButtons = gDownButtons;

    if (gQuitState)
    &#123;
        gPressedButtons |= (1 &lt;&lt; BTN_QUIT);
    &#125;
&#125;

void Common_Sleep(unsigned int ms)
&#123;
    usleep(ms * 1000);
&#125;

void Common_Exit(int returnCode)
&#123;
    exit(returnCode);
&#125;

void Common_DrawText(const char *text)
&#123;
    char s[256];
    snprintf(s, sizeof(s), &quot;%s\n&quot;, text);

    gUIString.append(s);
&#125;

void Common_LoadFileMemory(const char *name, void **buff, int *length)
&#123;
    FILE *file = fopen(name, &quot;rb&quot;);

    fseek(file, 0, SEEK_END);
    long len = ftell(file);
    fseek(file, 0, SEEK_SET);

    void *mem = malloc(len);
    fread(mem, 1, len, file);

    fclose(file);

    *buff = mem;
    *length = len;
&#125;

void Common_UnloadFileMemory(void *buff)
&#123;
    free(buff);
&#125;

bool Common_BtnPress(Common_Button btn)
&#123;
    return ((gPressedButtons &amp; (1 &lt;&lt; btn)) != 0);
&#125;

bool Common_BtnDown(Common_Button btn)
&#123;
    return ((gDownButtons &amp; (1 &lt;&lt; btn)) != 0);
&#125;

const char *Common_BtnStr(Common_Button btn)
&#123;
    switch (btn)
    &#123;
        case BTN_ACTION1: return &quot;A&quot;;
        case BTN_ACTION2: return &quot;B&quot;;
        case BTN_ACTION3: return &quot;C&quot;;
        case BTN_ACTION4: return &quot;D&quot;;
        case BTN_UP:      return &quot;Up&quot;;
        case BTN_DOWN:    return &quot;Down&quot;;
        case BTN_LEFT:    return &quot;Left&quot;;
        case BTN_RIGHT:   return &quot;Right&quot;;
        case BTN_MORE:    return &quot;E&quot;;
        case BTN_QUIT:    return &quot;Back&quot;;
        default:          return &quot;Unknown&quot;;
    &#125;
&#125;

const char *Common_MediaPath(const char *fileName)
&#123;
    char *filePath = (char *)calloc(256, sizeof(char));

    strcat(filePath, &quot;file:///android_asset/&quot;);
    strcat(filePath, fileName);
    gPathList.push_back(filePath);

    return filePath;
&#125;

const char *Common_WritePath(const char *fileName)
&#123;
    return Common_MediaPath(fileName);
&#125;

bool Common_SuspendState()
&#123;
    return gSuspendState;
&#125;

extern &quot;C&quot;
&#123;

jstring Java_org_fmod_core_FmodUtils_getButtonLabel(JNIEnv *env, jobject thiz, jint index)
&#123;
    return env-&gt;NewStringUTF(Common_BtnStr((Common_Button)index));
&#125;

void Java_org_fmod_core_FmodUtils_buttonDown(JNIEnv *env, jobject thiz, jint index)
&#123;
    gDownButtons |= (1 &lt;&lt; index);
&#125;

void Java_org_fmod_core_FmodUtils_buttonUp(JNIEnv *env, jobject thiz, jint index)
&#123;
    gDownButtons &amp;= ~(1 &lt;&lt; index);
&#125;

void Java_org_fmod_core_FmodUtils_setStateCreate(JNIEnv *env, jobject thiz)
&#123;

&#125;

void Java_org_fmod_core_FmodUtils_setStateStart(JNIEnv *env, jobject thiz)
&#123;
    gSuspendState = false;
&#125;

void Java_org_fmod_core_FmodUtils_setStateStop(JNIEnv *env, jobject thiz)
&#123;
    gSuspendState = true;
&#125;

void Java_org_fmod_core_FmodUtils_setStateDestroy(JNIEnv *env, jobject thiz)
&#123;
    gQuitState = true;
&#125;

void Java_org_fmod_core_FmodUtils_main(JNIEnv *env, jobject thiz,jobject act)
&#123;
    gJNIEnv = env;
    gMainActivityObject = act;

    FMOD_Main();
&#125;

&#125; /* extern &quot;C&quot; */
</code></pre><h4 id="1-3-替换MainActivity"><a href="#1-3-替换MainActivity" class="headerlink" title="1.3 替换MainActivity"></a>1.3 替换MainActivity</h4><p><strong>将 org.fmod.example.MainActivity 复制到自己的包路径下 ， 删除文件中 native 方法和 static 方法，新增 mFmodUtils 成员变量，并实例化，将调用 native 方法的地方都改成 mFmodUtils 实例下的方法，注意 main() 方法需要传当前 Activity 进去</strong></p>
<pre><code>public class MainActivity extends Activity implements OnTouchListener, Runnable &#123;
    private TextView mTxtScreen;
    private Thread mThread;
    private FmodUtils mFmodUtils;

    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        mFmodUtils = FmodUtils.getInstance();
        // Create the text area
        mTxtScreen = new TextView(this);
        mTxtScreen.setTextSize(TypedValue.COMPLEX_UNIT_SP, 10.0f);
        mTxtScreen.setTypeface(Typeface.MONOSPACE);

        // Create the buttons
        Button[] buttons = new Button[9];
        for (int i = 0; i &lt; buttons.length; i++) &#123;
            buttons[i] = new Button(this);
            buttons[i].setText(mFmodUtils.getButtonLabel(i));
            buttons[i].setOnTouchListener(this);
            buttons[i].setId(i);
        &#125;

        // Create the button row layouts
        LinearLayout llTopRowButtons = new LinearLayout(this);
        llTopRowButtons.setOrientation(LinearLayout.HORIZONTAL);
        LinearLayout llMiddleRowButtons = new LinearLayout(this);
        llMiddleRowButtons.setOrientation(LinearLayout.HORIZONTAL);
        LinearLayout llBottomRowButtons = new LinearLayout(this);
        llBottomRowButtons.setOrientation(LinearLayout.HORIZONTAL);

        // Create the main view layout
        LinearLayout llView = new LinearLayout(this);
        llView.setOrientation(LinearLayout.VERTICAL);

        // Create layout parameters
        LayoutParams lpLayout = new LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT, 1.0f);

        // Set up the view hierarchy
        llTopRowButtons.addView(buttons[0], lpLayout);
        llTopRowButtons.addView(buttons[6], lpLayout);
        llTopRowButtons.addView(buttons[1], lpLayout);
        llMiddleRowButtons.addView(buttons[4], lpLayout);
        llMiddleRowButtons.addView(buttons[8], lpLayout);
        llMiddleRowButtons.addView(buttons[5], lpLayout);
        llBottomRowButtons.addView(buttons[2], lpLayout);
        llBottomRowButtons.addView(buttons[7], lpLayout);
        llBottomRowButtons.addView(buttons[3], lpLayout);
        llView.addView(mTxtScreen, lpLayout);
        llView.addView(llTopRowButtons);
        llView.addView(llMiddleRowButtons);
        llView.addView(llBottomRowButtons);

        setContentView(llView);

        // Request necessary permissions
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;
            String[] perms = &#123;&quot;android.permission.RECORD_AUDIO&quot;, &quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;&#125;;
            if (checkSelfPermission(perms[0]) == PackageManager.PERMISSION_DENIED ||
                    checkSelfPermission(perms[1]) == PackageManager.PERMISSION_DENIED) &#123;
                requestPermissions(perms, 200);
            &#125;
        &#125;

        org.fmod.FMOD.init(this);

        mThread = new Thread(this, &quot;Example Main&quot;);
        mThread.start();

        mFmodUtils.setStateCreate();
    &#125;

    @Override
    protected void onStart() &#123;
        super.onStart();
        mFmodUtils.setStateStart();
    &#125;

    @Override
    protected void onStop() &#123;
        mFmodUtils.setStateStop();
        super.onStop();
    &#125;

    @Override
    protected void onDestroy() &#123;
        mFmodUtils.setStateDestroy();

        try &#123;
            mThread.join();
        &#125; catch (InterruptedException e) &#123;
        &#125;

        org.fmod.FMOD.close();

        super.onDestroy();
    &#125;

    @Override
    public boolean onTouch(View view, MotionEvent motionEvent) &#123;
        if (motionEvent.getAction() == MotionEvent.ACTION_DOWN) &#123;
            mFmodUtils.buttonDown(view.getId());
        &#125; else if (motionEvent.getAction() == MotionEvent.ACTION_UP) &#123;
            mFmodUtils.buttonUp(view.getId());
        &#125;

        return true;
    &#125;

    @Override
    public void run() &#123;
        mFmodUtils.main(this);
    &#125;

    public void updateScreen(final String text) &#123;
        runOnUiThread(new Runnable() &#123;
            @Override
            public void run() &#123;
                mTxtScreen.setText(text);
            &#125;
        &#125;);
    &#125;


&#125;
</code></pre><h4 id="1-4-更改AndroidManifest"><a href="#1-4-更改AndroidManifest" class="headerlink" title="1.4 更改AndroidManifest"></a>1.4 更改AndroidManifest</h4><p><strong>更改 AndroidManifest.xml 文件中的启动页的 Activity 为自己包路径下的 MainActivity ，删除fmod 示例的 MainActivity ,就可以运行成功了</strong></p>
<h3 id="2、实现按钮-D-和-E-播放音频"><a href="#2、实现按钮-D-和-E-播放音频" class="headerlink" title="2、实现按钮 D 和 E 播放音频"></a>2、实现按钮 D 和 E 播放音频</h3><p><strong>我们使用 singing.wav 和 wave.mp3 来实现 D 和 E 按钮播放音频的功能</strong></p>
<h4 id="2-1-加载音频文件"><a href="#2-1-加载音频文件" class="headerlink" title="2.1 加载音频文件"></a>2.1 加载音频文件</h4><p><strong>在play_sound.cpp 中的 FMOD_Main() 函数中的do…while前，定义 sound4 和 sound5 变量，然后使用这两个变量加载对应的音频文件</strong></p>
<pre><code>    FMOD::System     *system;
    // 新增属性 sound4 和 sound5
    FMOD::Sound      *sound1, *sound2, *sound3, *sound4, *sound5;
    FMOD::Channel    *channel = 0;
    FMOD_RESULT       result;
    unsigned int      version;
    void             *extradriverdata = 0;

    Common_Init(&amp;extradriverdata);

    /*
        Create a System object and initialize
    */
    result = FMOD::System_Create(&amp;system);
    ERRCHECK(result);

    result = system-&gt;getVersion(&amp;version);
    ERRCHECK(result);

    if (version &lt; FMOD_VERSION)
    &#123;
        Common_Fatal(&quot;FMOD lib version %08x doesn&#39;t match header version %08x&quot;, version, FMOD_VERSION);
    &#125;

    result = system-&gt;init(32, FMOD_INIT_NORMAL, extradriverdata);
    ERRCHECK(result);

    result = system-&gt;createSound(Common_MediaPath(&quot;drumloop.wav&quot;), FMOD_DEFAULT, 0, &amp;sound1);
    ERRCHECK(result);

    result = sound1-&gt;setMode(FMOD_LOOP_OFF);    /* drumloop.wav has embedded loop points which automatically makes looping turn on, */
    ERRCHECK(result);                           /* so turn it off here.  We could have also just put FMOD_LOOP_OFF in the above CreateSound call. */

    result = system-&gt;createSound(Common_MediaPath(&quot;jaguar.wav&quot;), FMOD_DEFAULT, 0, &amp;sound2);
    ERRCHECK(result);

    result = system-&gt;createSound(Common_MediaPath(&quot;swish.wav&quot;), FMOD_DEFAULT, 0, &amp;sound3);
    ERRCHECK(result);

    //为sound4 加载音频文件singing.wav
    result = system-&gt;createSound(Common_MediaPath(&quot;singing.wav&quot;), FMOD_DEFAULT, 0, &amp;sound4);
    ERRCHECK(result);

    //为sound5 加载音频文件wave.mp3
    result = system-&gt;createSound(Common_MediaPath(&quot;wave.mp3&quot;), FMOD_DEFAULT, 0, &amp;sound5);
    ERRCHECK(result);</code></pre><h4 id="2-2-将音频播放与按钮事件关联"><a href="#2-2-将音频播放与按钮事件关联" class="headerlink" title="2.2 将音频播放与按钮事件关联"></a>2.2 将音频播放与按钮事件关联</h4><p><strong>在play_sound.cpp 中的 FMOD_Main() 函数中的do…while的{}中，处理 D 和 E 按钮的事件，播放sound4 和 sound 5 , 按钮的事件类型可在 common_platform.cpp 中的 Common_BtnStr 函数中查看</strong></p>
<p>Common_BtnStr 函数</p>
<pre><code>const char *Common_BtnStr(Common_Button btn)
&#123;
    switch (btn)
    &#123;
        case BTN_ACTION1: return &quot;A&quot;;
        case BTN_ACTION2: return &quot;B&quot;;
        case BTN_ACTION3: return &quot;C&quot;;
        case BTN_ACTION4: return &quot;D&quot;;
        case BTN_UP:      return &quot;Up&quot;;
        case BTN_DOWN:    return &quot;Down&quot;;
        case BTN_LEFT:    return &quot;Left&quot;;
        case BTN_RIGHT:   return &quot;Right&quot;;
        case BTN_MORE:    return &quot;E&quot;;
        case BTN_QUIT:    return &quot;Back&quot;;
        default:          return &quot;Unknown&quot;;
    &#125;
&#125;
</code></pre><p>处理 D 和 E 按钮的事件，播放音频</p>
<pre><code>        //处理按钮 D 的事件，播放 sound4
        if (Common_BtnPress(BTN_ACTION4))
        &#123;
            result = system-&gt;playSound(sound4, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        //处理按钮 E 的事件，播放 sound5
        if (Common_BtnPress(BTN_MORE))
        &#123;
            result = system-&gt;playSound(sound5, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;</code></pre><h4 id="2-3-释放-sound4-和-sound5"><a href="#2-3-释放-sound4-和-sound5" class="headerlink" title="2.3 释放 sound4 和 sound5"></a>2.3 释放 sound4 和 sound5</h4><p><strong>在do…while 执行之后，释放加载了对应音频文件的属性</strong></p>
<pre><code>/*
        Shut down
    */
    result = sound1-&gt;release();
    ERRCHECK(result);
    result = sound2-&gt;release();
    ERRCHECK(result);
    result = sound3-&gt;release();
    ERRCHECK(result);

    //释放sound4
    result = sound4-&gt;release();
    ERRCHECK(result);
    //释放sound5
    result = sound5-&gt;release();
    ERRCHECK(result);

    result = system-&gt;close();
    ERRCHECK(result);
    result = system-&gt;release();
    ERRCHECK(result);

    Common_Close();</code></pre><h4 id="2-4-play-sound-cpp-完整代码"><a href="#2-4-play-sound-cpp-完整代码" class="headerlink" title="2.4 play_sound.cpp 完整代码"></a>2.4 play_sound.cpp 完整代码</h4><p><strong>更改完成之后，按钮D 和 E 播放音频的功能实现了，点击运行就可以了，下面贴上play_sound.cpp的完整代码</strong></p>
<pre><code>/*==============================================================================
Play Sound Example
Copyright (c), Firelight Technologies Pty, Ltd 2004-2019.

This example shows how to simply load and play multiple sounds, the simplest 
usage of FMOD. By default FMOD will decode the entire file into memory when it
loads. If the sounds are big and possibly take up a lot of RAM it would be
better to use the FMOD_CREATESTREAM flag, this will stream the file in realtime
as it plays.
==============================================================================*/
#include &quot;inc/fmod.hpp&quot;
#include &quot;common.h&quot;

int FMOD_Main()
&#123;
    FMOD::System     *system;
    // 新增属性 sound4 和 sound5
    FMOD::Sound      *sound1, *sound2, *sound3, *sound4, *sound5;
    FMOD::Channel    *channel = 0;
    FMOD_RESULT       result;
    unsigned int      version;
    void             *extradriverdata = 0;

    Common_Init(&amp;extradriverdata);

    /*
        Create a System object and initialize
    */
    result = FMOD::System_Create(&amp;system);
    ERRCHECK(result);

    result = system-&gt;getVersion(&amp;version);
    ERRCHECK(result);

    if (version &lt; FMOD_VERSION)
    &#123;
        Common_Fatal(&quot;FMOD lib version %08x doesn&#39;t match header version %08x&quot;, version, FMOD_VERSION);
    &#125;

    result = system-&gt;init(32, FMOD_INIT_NORMAL, extradriverdata);
    ERRCHECK(result);

    result = system-&gt;createSound(Common_MediaPath(&quot;drumloop.wav&quot;), FMOD_DEFAULT, 0, &amp;sound1);
    ERRCHECK(result);

    result = sound1-&gt;setMode(FMOD_LOOP_OFF);    /* drumloop.wav has embedded loop points which automatically makes looping turn on, */
    ERRCHECK(result);                           /* so turn it off here.  We could have also just put FMOD_LOOP_OFF in the above CreateSound call. */

    result = system-&gt;createSound(Common_MediaPath(&quot;jaguar.wav&quot;), FMOD_DEFAULT, 0, &amp;sound2);
    ERRCHECK(result);

    result = system-&gt;createSound(Common_MediaPath(&quot;swish.wav&quot;), FMOD_DEFAULT, 0, &amp;sound3);
    ERRCHECK(result);

    //为sound4 加载音频文件singing.wav
    result = system-&gt;createSound(Common_MediaPath(&quot;singing.wav&quot;), FMOD_DEFAULT, 0, &amp;sound4);
    ERRCHECK(result);

    //为sound5 加载音频文件wave.mp3
    result = system-&gt;createSound(Common_MediaPath(&quot;wave.mp3&quot;), FMOD_DEFAULT, 0, &amp;sound5);
    ERRCHECK(result);

    /*
        Main loop
    */
    do
    &#123;
        Common_Update();

        if (Common_BtnPress(BTN_ACTION1))
        &#123;
            result = system-&gt;playSound(sound1, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        if (Common_BtnPress(BTN_ACTION2))
        &#123;
            result = system-&gt;playSound(sound2, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        if (Common_BtnPress(BTN_ACTION3))
        &#123;
            result = system-&gt;playSound(sound3, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        //处理按钮 D 的事件，播放 sound4
        if (Common_BtnPress(BTN_ACTION4))
        &#123;
            result = system-&gt;playSound(sound4, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        //处理按钮 E 的事件，播放 sound5
        if (Common_BtnPress(BTN_MORE))
        &#123;
            result = system-&gt;playSound(sound5, 0, false, &amp;channel);
            ERRCHECK(result);
        &#125;

        result = system-&gt;update();
        ERRCHECK(result);

        &#123;
            unsigned int ms = 0;
            unsigned int lenms = 0;
            bool         playing = 0;
            bool         paused = 0;
            int          channelsplaying = 0;

            if (channel)
            &#123;
                FMOD::Sound *currentsound = 0;

                result = channel-&gt;isPlaying(&amp;playing);
                if ((result != FMOD_OK) &amp;&amp; (result != FMOD_ERR_INVALID_HANDLE) &amp;&amp; (result != FMOD_ERR_CHANNEL_STOLEN))
                &#123;
                    ERRCHECK(result);
                &#125;

                result = channel-&gt;getPaused(&amp;paused);
                if ((result != FMOD_OK) &amp;&amp; (result != FMOD_ERR_INVALID_HANDLE) &amp;&amp; (result != FMOD_ERR_CHANNEL_STOLEN))
                &#123;
                    ERRCHECK(result);
                &#125;

                result = channel-&gt;getPosition(&amp;ms, FMOD_TIMEUNIT_MS);
                if ((result != FMOD_OK) &amp;&amp; (result != FMOD_ERR_INVALID_HANDLE) &amp;&amp; (result != FMOD_ERR_CHANNEL_STOLEN))
                &#123;
                    ERRCHECK(result);
                &#125;

                channel-&gt;getCurrentSound(&amp;currentsound);
                if (currentsound)
                &#123;
                    result = currentsound-&gt;getLength(&amp;lenms, FMOD_TIMEUNIT_MS);
                    if ((result != FMOD_OK) &amp;&amp; (result != FMOD_ERR_INVALID_HANDLE) &amp;&amp; (result != FMOD_ERR_CHANNEL_STOLEN))
                    &#123;
                        ERRCHECK(result);
                    &#125;
                &#125;
            &#125;

            system-&gt;getChannelsPlaying(&amp;channelsplaying, NULL);

            Common_Draw(&quot;==================================================&quot;);
            Common_Draw(&quot;Play Sound Example.&quot;);
            Common_Draw(&quot;Copyright (c) Firelight Technologies 2004-2019.&quot;);
            Common_Draw(&quot;==================================================&quot;);
            Common_Draw(&quot;&quot;);
            Common_Draw(&quot;Press %s to play a mono sound (drumloop)&quot;, Common_BtnStr(BTN_ACTION1));
            Common_Draw(&quot;Press %s to play a mono sound (jaguar)&quot;, Common_BtnStr(BTN_ACTION2));
            Common_Draw(&quot;Press %s to play a stereo sound (swish)&quot;, Common_BtnStr(BTN_ACTION3));
            Common_Draw(&quot;Press %s to quit&quot;, Common_BtnStr(BTN_QUIT));
            Common_Draw(&quot;&quot;);
            Common_Draw(&quot;Time %02d:%02d:%02d/%02d:%02d:%02d : %s&quot;, ms / 1000 / 60, ms / 1000 % 60, ms / 10 % 100, lenms / 1000 / 60, lenms / 1000 % 60, lenms / 10 % 100, paused ? &quot;Paused &quot; : playing ? &quot;Playing&quot; : &quot;Stopped&quot;);
            Common_Draw(&quot;Channels Playing %d&quot;, channelsplaying);
        &#125;

        Common_Sleep(50);
    &#125; while (!Common_BtnPress(BTN_QUIT));

    /*
        Shut down
    */
    result = sound1-&gt;release();
    ERRCHECK(result);
    result = sound2-&gt;release();
    ERRCHECK(result);
    result = sound3-&gt;release();
    ERRCHECK(result);

    //释放sound4
    result = sound4-&gt;release();
    ERRCHECK(result);
    //释放sound5
    result = sound5-&gt;release();
    ERRCHECK(result);

    result = system-&gt;close();
    ERRCHECK(result);
    result = system-&gt;release();
    ERRCHECK(result);

    Common_Close();

    return 0;
&#125;
</code></pre><h2 id="项目源码"><a href="#项目源码" class="headerlink" title="项目源码"></a>项目源码</h2><p><a target="_blank" rel="noopener" href="https://github.com/onestravel/playSound">PlaySound源码</a></p>
<p><strong>到此，我们实现集成 fmod 的音频播放功能已经实现，也实现了其他按钮播放音频文件的功能，这是实现模拟QQ变声项目的前期准备，后面我们会继续实现QQ变声功能。</strong></p>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/about">一个人的旅行</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://blog.onestravel.cn/20190310/9fcf14b14bdc/">https://blog.onestravel.cn/20190310/9fcf14b14bdc/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/20190310/83465f93f3f4/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">二叉树的下一个节点 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/20190309/3e9f753d010c/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">重建二叉树 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content comment-card" style="margin-top: 16px;">
  <div class="comment-card-title">评论</div>
  
  <div id="gitalk-container"></div>
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

  
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  
<script src="/js/lib/md5.min.js"></script>

  <script>
    var gitalk = new Gitalk({
      clientID: 'a52a65db0a634019e27f',
      clientSecret: 'a04eaebc103e73d3769221171a4b87b55b39998d',
      repo: 'onestravel.github.io',
      owner: 'onestravel',
      admin: "onestravel",
      id: md5(location.href),
      distractionFreeMode: true,
      language: 'navigator.language || navigator.userLanguage',
      labels: ["Gitalk"],
      perPage: 10
    })

    gitalk.render('gitalk-container')
  </script>

</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AndroidStudio%E4%B8%8B%E9%9B%86%E6%88%90Fmod%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BB%BFQQ%E5%8F%98%E5%A3%B0%E6%95%88%E6%9E%9C"><span class="toc-text">AndroidStudio下集成Fmod，实现仿QQ变声效果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-text">一、前期准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E7%8E%B0%E4%BD%BF%E7%94%A8fmod%E6%92%AD%E6%94%BEassets%E4%B8%8B%E7%9A%84%E9%9F%B3%E9%A2%91"><span class="toc-text">二、实现使用fmod播放assets下的音频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%94%AF%E6%8C%81C-%E7%9A%84Android%E9%A1%B9%E7%9B%AE"><span class="toc-text">1、创建一个支持C++的Android项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEAndroid%E9%A1%B9%E7%9B%AE"><span class="toc-text">2、配置Android项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0"><span class="toc-text">三、项目改造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8A%BD%E5%8F%96-FmodUtils-java-%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E5%8C%85%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84-MainActivity-%E5%AE%9E%E7%8E%B0%E6%92%AD%E6%94%BE"><span class="toc-text">1、抽取 FmodUtils.java 工具类，使用自己包路径下的 MainActivity 实现播放</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-FmodUtils-java-%E7%B1%BB%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%8E%9F%E6%9C%89main-%E6%96%B9%E6%B3%95%E5%8A%A0%E4%BA%86%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BC%A0%E5%85%A5Activity%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-text">1.1 FmodUtils.java 类如下，在原有main()方法加了参数，传入Activity实例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9B%B4%E6%94%B9cpp-%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84-native-%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 更改cpp 文件中的 native 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9B%BF%E6%8D%A2MainActivity"><span class="toc-text">1.3 替换MainActivity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%9B%B4%E6%94%B9AndroidManifest"><span class="toc-text">1.4 更改AndroidManifest</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE-D-%E5%92%8C-E-%E6%92%AD%E6%94%BE%E9%9F%B3%E9%A2%91"><span class="toc-text">2、实现按钮 D 和 E 播放音频</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%8A%A0%E8%BD%BD%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 加载音频文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%B0%86%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E4%B8%8E%E6%8C%89%E9%92%AE%E4%BA%8B%E4%BB%B6%E5%85%B3%E8%81%94"><span class="toc-text">2.2 将音频播放与按钮事件关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%87%8A%E6%94%BE-sound4-%E5%92%8C-sound5"><span class="toc-text">2.3 释放 sound4 和 sound5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-play-sound-cpp-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-text">2.4 play_sound.cpp 完整代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81"><span class="toc-text">项目源码</span></a></li></ol></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/medias/avatar.jpg" class="author-img">

<p class="author-name">一个人的旅行</p>
<p class="author-description">冰冻三尺，非一日之寒；为山九仞，岂一日之功；不忘初心，方得始终！</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>69</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>14</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>47</span>
    <span>标签</span>
  </a>
</div>

<div class="author-card-society">
  
    <div class="author-card-society-icon">
      <a target="_blank" rel="noopener" href="https://github.com/onestravel">
        <i class="iconfont icon-github society-icon"></i>
      </a>
    </div>
  
    <div class="author-card-society-icon">
      <a href="mailto:service@onestravel.cn">
        <i class="iconfont icon-mail society-icon"></i>
      </a>
    </div>
  
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AndroidStudio%E4%B8%8B%E9%9B%86%E6%88%90Fmod%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BB%BFQQ%E5%8F%98%E5%A3%B0%E6%95%88%E6%9E%9C"><span class="toc-text">AndroidStudio下集成Fmod，实现仿QQ变声效果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-text">一、前期准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E7%8E%B0%E4%BD%BF%E7%94%A8fmod%E6%92%AD%E6%94%BEassets%E4%B8%8B%E7%9A%84%E9%9F%B3%E9%A2%91"><span class="toc-text">二、实现使用fmod播放assets下的音频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%94%AF%E6%8C%81C-%E7%9A%84Android%E9%A1%B9%E7%9B%AE"><span class="toc-text">1、创建一个支持C++的Android项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEAndroid%E9%A1%B9%E7%9B%AE"><span class="toc-text">2、配置Android项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0"><span class="toc-text">三、项目改造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8A%BD%E5%8F%96-FmodUtils-java-%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E5%8C%85%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84-MainActivity-%E5%AE%9E%E7%8E%B0%E6%92%AD%E6%94%BE"><span class="toc-text">1、抽取 FmodUtils.java 工具类，使用自己包路径下的 MainActivity 实现播放</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-FmodUtils-java-%E7%B1%BB%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%8E%9F%E6%9C%89main-%E6%96%B9%E6%B3%95%E5%8A%A0%E4%BA%86%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BC%A0%E5%85%A5Activity%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-text">1.1 FmodUtils.java 类如下，在原有main()方法加了参数，传入Activity实例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9B%B4%E6%94%B9cpp-%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84-native-%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 更改cpp 文件中的 native 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9B%BF%E6%8D%A2MainActivity"><span class="toc-text">1.3 替换MainActivity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%9B%B4%E6%94%B9AndroidManifest"><span class="toc-text">1.4 更改AndroidManifest</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE-D-%E5%92%8C-E-%E6%92%AD%E6%94%BE%E9%9F%B3%E9%A2%91"><span class="toc-text">2、实现按钮 D 和 E 播放音频</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%8A%A0%E8%BD%BD%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 加载音频文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%B0%86%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E4%B8%8E%E6%8C%89%E9%92%AE%E4%BA%8B%E4%BB%B6%E5%85%B3%E8%81%94"><span class="toc-text">2.2 将音频播放与按钮事件关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%87%8A%E6%94%BE-sound4-%E5%92%8C-sound5"><span class="toc-text">2.3 释放 sound4 和 sound5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-play-sound-cpp-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-text">2.4 play_sound.cpp 完整代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81"><span class="toc-text">项目源码</span></a></li></ol></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
      <a href="/categories/NDK/">
        <div class="categories-list-item">
          NDK
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Android/">
        <div class="categories-list-item">
          Android
          <span class="categories-list-item-badge">9</span>
        </div>
      </a>
    
      <a href="/categories/CPlusPlus/">
        <div class="categories-list-item">
          CPlusPlus
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/C/">
        <div class="categories-list-item">
          C
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/前端H5/">
        <div class="categories-list-item">
          前端H5
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/JNI/">
        <div class="categories-list-item">
          JNI
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/算法/">
        <div class="categories-list-item">
          算法
          <span class="categories-list-item-badge">18</span>
        </div>
      </a>
    
      <a href="/categories/DevTools/">
        <div class="categories-list-item">
          DevTools
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/SpringBoot/">
        <div class="categories-list-item">
          SpringBoot
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Jenkins/">
        <div class="categories-list-item">
          Jenkins
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Kotlin/">
        <div class="categories-list-item">
          Kotlin
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/Linux/">
        <div class="categories-list-item">
          Linux
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/JAVA/">
        <div class="categories-list-item">
          JAVA
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Git/">
        <div class="categories-list-item">
          Git
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
    <a href="/tags/Android/" title="Android"><div class="tags-list-item">Android</div></a>
    
    <a href="/tags/Kotlin/" title="Kotlin"><div class="tags-list-item">Kotlin</div></a>
    
    <a href="/tags/CPlusPlus/" title="CPlusPlus"><div class="tags-list-item">CPlusPlus</div></a>
    
    <a href="/tags/NDK/" title="NDK"><div class="tags-list-item">NDK</div></a>
    
    <a href="/tags/C/" title="C"><div class="tags-list-item">C</div></a>
    
    <a href="/tags/JVM/" title="JVM"><div class="tags-list-item">JVM</div></a>
    
    <a href="/tags/数组/" title="数组"><div class="tags-list-item">数组</div></a>
    
    <a href="/tags/自动化部署/" title="自动化部署"><div class="tags-list-item">自动化部署</div></a>
    
    <a href="/tags/Jenkins/" title="Jenkins"><div class="tags-list-item">Jenkins</div></a>
    
    <a href="/tags/斐波那契数列/" title="斐波那契数列"><div class="tags-list-item">斐波那契数列</div></a>
    
    <a href="/tags/Intellij-IDEA/" title="Intellij IDEA"><div class="tags-list-item">Intellij IDEA</div></a>
    
    <a href="/tags/html/" title="html"><div class="tags-list-item">html</div></a>
    
    <a href="/tags/JNI/" title="JNI"><div class="tags-list-item">JNI</div></a>
    
    <a href="/tags/Linux/" title="Linux"><div class="tags-list-item">Linux</div></a>
    
    <a href="/tags/矩阵/" title="矩阵"><div class="tags-list-item">矩阵</div></a>
    
    <a href="/tags/centos/" title="centos"><div class="tags-list-item">centos</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AndroidStudio%E4%B8%8B%E9%9B%86%E6%88%90Fmod%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BB%BFQQ%E5%8F%98%E5%A3%B0%E6%95%88%E6%9E%9C"><span class="toc-text">AndroidStudio下集成Fmod，实现仿QQ变声效果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-text">一、前期准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9E%E7%8E%B0%E4%BD%BF%E7%94%A8fmod%E6%92%AD%E6%94%BEassets%E4%B8%8B%E7%9A%84%E9%9F%B3%E9%A2%91"><span class="toc-text">二、实现使用fmod播放assets下的音频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%94%AF%E6%8C%81C-%E7%9A%84Android%E9%A1%B9%E7%9B%AE"><span class="toc-text">1、创建一个支持C++的Android项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AEAndroid%E9%A1%B9%E7%9B%AE"><span class="toc-text">2、配置Android项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0"><span class="toc-text">三、项目改造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8A%BD%E5%8F%96-FmodUtils-java-%E5%B7%A5%E5%85%B7%E7%B1%BB%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E5%8C%85%E8%B7%AF%E5%BE%84%E4%B8%8B%E7%9A%84-MainActivity-%E5%AE%9E%E7%8E%B0%E6%92%AD%E6%94%BE"><span class="toc-text">1、抽取 FmodUtils.java 工具类，使用自己包路径下的 MainActivity 实现播放</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-FmodUtils-java-%E7%B1%BB%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%8E%9F%E6%9C%89main-%E6%96%B9%E6%B3%95%E5%8A%A0%E4%BA%86%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BC%A0%E5%85%A5Activity%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-text">1.1 FmodUtils.java 类如下，在原有main()方法加了参数，传入Activity实例：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9B%B4%E6%94%B9cpp-%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84-native-%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 更改cpp 文件中的 native 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9B%BF%E6%8D%A2MainActivity"><span class="toc-text">1.3 替换MainActivity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%9B%B4%E6%94%B9AndroidManifest"><span class="toc-text">1.4 更改AndroidManifest</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E7%8E%B0%E6%8C%89%E9%92%AE-D-%E5%92%8C-E-%E6%92%AD%E6%94%BE%E9%9F%B3%E9%A2%91"><span class="toc-text">2、实现按钮 D 和 E 播放音频</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%8A%A0%E8%BD%BD%E9%9F%B3%E9%A2%91%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 加载音频文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%B0%86%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE%E4%B8%8E%E6%8C%89%E9%92%AE%E4%BA%8B%E4%BB%B6%E5%85%B3%E8%81%94"><span class="toc-text">2.2 将音频播放与按钮事件关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%87%8A%E6%94%BE-sound4-%E5%92%8C-sound5"><span class="toc-text">2.3 释放 sound4 和 sound5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-play-sound-cpp-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-text">2.4 play_sound.cpp 完整代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81"><span class="toc-text">项目源码</span></a></li></ol></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-09-20</div>
        <a href="/20210920/f8c53c115779/"><div class="recent-posts-item-content">【并发编程】线程基础</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-07-28</div>
        <a href="/20210728/9c2efe6aefcb/"><div class="recent-posts-item-content">【笔记四】编译插桩操纵字节码，实现不可能完成的任务</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-05-28</div>
        <a href="/20210528/618470f841d8/"><div class="recent-posts-item-content">【笔记三】字节码层面分析 class 文件结构</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-03-28</div>
        <a href="/20210328/68b72d473df5/"><div class="recent-posts-item-content">【笔记二】GC 回收机制和分代回收策略</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2022
        </span>
        &nbsp;
        <a href="/" class="footer-link">一个人的旅行 </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
      <div class="footer-dsc">
        
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
        <span>&nbsp;|&nbsp;</span>
        
        
        本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton"  aria-label="回到顶部">
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton" aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget" aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget" aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  

  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.setAttribute('aria-label', 'illustration');
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      if (img[i].alt) wrapper.dataset.caption = img[i].alt;
      wrapper.dataset.nolink = true;
      img[i].before(wrapper);
      wrapper.append(img[i]);
      var divWrap = document.createElement('div');
      divWrap.classList.add('gallery');
      wrapper.before(divWrap);
      divWrap.append(wrapper);
    }
    baguetteBox.run('.gallery');
  }
</script>
<script>loadScript("/js/lib/lightbox/baguetteBox.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  <script>loadScript("/js/lib/busuanzi.min.js")</script>
  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
  <script>
    var googleAnalytics = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-145377665-1');
    }
  </script>
  <script>loadScript("https://www.googletagmanager.com/gtag/js?id=" + "UA-145377665-1", googleAnalytics)</script>
  
</body>

</html>